/*! Locuszoom 0.13.0-beta.2 */
var LocusZoom=function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}({0:function(t,e){t.exports=d3},1:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return u}));var a=n(0);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=Math.sqrt(3),o={draw:function(t,e){var n=-Math.sqrt(e/(3*i));t.moveTo(0,2*-n),t.lineTo(-i*n,n),t.lineTo(i*n,n),t.closePath()}};function s(t,e,n){if(e?"string"==typeof e&&(e={default:e}):e={default:""},"string"==typeof t){for(var a,i,o,c,u=/\{\{namespace(\[[A-Za-z_0-9]+\]|)\}\}/g,h=[];null!==(a=u.exec(t));)i=a[0],o=a[1].length?a[1].replace(/(\[|\])/g,""):null,c=n,null!=e&&"object"==r(e)&&void 0!==e[o]&&(c=e[o]+(e[o].length?":":"")),h.push({base:i,namespace:c});for(var d in h)t=t.replace(h[d].base,h[d].namespace)}else if("object"==r(t)&&null!=t){var p,f;if(void 0!==t.namespace)e=l(e,"string"==typeof t.namespace?{default:t.namespace}:t.namespace);for(var y in t)"namespace"!==y&&(p=s(t[y],e,n),y!==(f=s(y,e,n))&&delete t[y],t[f]=p)}return t}function l(t,e){if("object"!==r(t)||"object"!==r(e))throw new Error("LocusZoom.Layouts.merge only accepts two layout objects; ".concat(r(t),", ").concat(r(e)," given"));for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=null===t[n]?"undefined":r(t[n]),i=r(e[n]);if("object"===a&&Array.isArray(t[n])&&(a="array"),"object"===i&&Array.isArray(e[n])&&(i="array"),"function"===a||"function"===i)throw new Error("LocusZoom.Layouts.merge encountered an unsupported property type");"undefined"!==a?"object"!==a||"object"!==i||(t[n]=l(t[n],e[n])):t[n]=c(e[n])}return t}function c(t){return JSON.parse(JSON.stringify(t))}function u(t){if(!t)return null;if("triangledown"===t)return o;var e="symbol".concat(t.charAt(0).toUpperCase()+t.slice(1));return a[e]||null}},12:function(t,e,n){"use strict";n.r(e);var a={};n.r(a),n.d(a,"log10",(function(){return N})),n.d(a,"neglog10",(function(){return T})),n.d(a,"logtoscinotation",(function(){return I})),n.d(a,"scinotation",(function(){return D})),n.d(a,"htmlescape",(function(){return C})),n.d(a,"urlencode",(function(){return L}));var r={};n.r(r),n.d(r,"BaseWidget",(function(){return zt})),n.d(r,"_Button",(function(){return Et})),n.d(r,"dimensions",(function(){return Mt})),n.d(r,"display_options",(function(){return qt})),n.d(r,"download",(function(){return Rt})),n.d(r,"download_png",(function(){return Nt})),n.d(r,"filter_field",(function(){return At})),n.d(r,"menu",(function(){return Bt})),n.d(r,"move_panel_down",(function(){return Dt})),n.d(r,"move_panel_up",(function(){return It})),n.d(r,"region_scale",(function(){return Pt})),n.d(r,"resize_to_data",(function(){return Ut})),n.d(r,"set_state",(function(){return Gt})),n.d(r,"shift_region",(function(){return Ct})),n.d(r,"remove_panel",(function(){return Tt})),n.d(r,"title",(function(){return jt})),n.d(r,"toggle_legend",(function(){return Ft})),n.d(r,"zoom_region",(function(){return Lt}));var i={};n.r(i),n.d(i,"categorical_bin",(function(){return we})),n.d(i,"if_value",(function(){return be})),n.d(i,"interpolate",(function(){return Se})),n.d(i,"numerical_bin",(function(){return xe})),n.d(i,"ordinal_cycle",(function(){return ke}));var o={};n.r(o),n.d(o,"BaseDataLayer",(function(){return Ce})),n.d(o,"annotation_track",(function(){return Ke})),n.d(o,"arcs",(function(){return en})),n.d(o,"forest",(function(){return fn})),n.d(o,"category_forest",(function(){return yn})),n.d(o,"genes",(function(){return Sn})),n.d(o,"line",(function(){return In})),n.d(o,"orthogonal_line",(function(){return Cn})),n.d(o,"scatter",(function(){return Jn})),n.d(o,"category_scatter",(function(){return Vn}));var s={};n.r(s),n.d(s,"tooltip",(function(){return Da})),n.d(s,"toolbar_widgets",(function(){return Ca})),n.d(s,"toolbar",(function(){return La})),n.d(s,"data_layer",(function(){return Ba})),n.d(s,"panel",(function(){return Ua})),n.d(s,"plot",(function(){return Fa}));function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e,n){return(c=f()?Reflect.construct:function(t,e,n){var a=[null];a.push.apply(a,e);var r=new(Function.bind.apply(t,a));return n&&h(r,n.prototype),r}).apply(null,arguments)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){var e=f();return function(){var n,a=y(t);if(e){var r=y(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return p(this,n)}}function p(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function m(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),t}var v=function(){function t(){_(this,t),this._items=new Map}return m(t,[{key:"get",value:function(t){if(!this._items.has(t))throw new Error("Item not found: ".concat(t));return this._items.get(t)}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n&&this._items.has(t))throw new Error("Item ".concat(t," is already defined"));return this._items.set(t,e),e}},{key:"remove",value:function(t){return this._items.delete(t)}},{key:"has",value:function(t){return this._items.has(t)}},{key:"list",value:function(){return Array.from(this._items.keys())}}]),t}(),b=function(t){u(n,t);var e=d(n);function n(){return _(this,n),e.apply(this,arguments)}return m(n,[{key:"create",value:function(t){for(var e=this.get(t),n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return c(e,a)}},{key:"extend",value:function(t,e,n){if(console.warn("Deprecation warning: .extend method will be removed in future versions, in favor of explicit ES6 subclasses"),3!==arguments.length)throw new Error("Invalid arguments to .extend");var a=this.get(t),r=function(t){u(n,t);var e=d(n);function n(){return _(this,n),e.apply(this,arguments)}return n}(a);return Object.assign(r.prototype,n,a),this.add(e,r),r}}]),n}(v),x=n(2);function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}for(var S=new b,O=0,z=Object.entries(x);O<z.length;O++){var E=w(z[O],2),j=E[0],M=E[1];S.add(j,M)}S.add("StaticJSON",x.StaticSource),S.add("LDLZ2",x.LDServer);var P=S,A=n(0),R={verbs:["highlight","select","fade","hide"],adjectives:["highlighted","selected","faded","hidden"]};function N(t){return isNaN(t)||t<=0?null:Math.log(t)/Math.LN10}function T(t){return isNaN(t)||t<=0?null:-Math.log(t)/Math.LN10}function I(t){if(isNaN(t))return"NaN";if(0===t)return"1";var e=Math.ceil(t),n=e-t,a=Math.pow(10,n);return 1===e?(a/10).toFixed(4):2===e?(a/100).toFixed(3):"".concat(a.toFixed(2)," × 10^-").concat(e)}function D(t){if(isNaN(t))return"NaN";if(0===t)return"0";var e,n=Math.abs(t);return e=n>1?Math.ceil(Math.log(n)/Math.LN10):Math.floor(Math.log(n)/Math.LN10),Math.abs(e)<=3?t.toFixed(3):t.toExponential(2).replace("+","").replace("e"," × 10^")}function C(t){return t?(t="".concat(t)).replace(/['"<>&`]/g,(function(t){switch(t){case"'":return"&#039;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"`":return"&#x60;"}})):""}function L(t){return encodeURIComponent(t)}function B(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function H(t,e,n){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=J(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Z(t,e){return(Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=J(t);if(e){var r=J(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return $(this,n)}}function $(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}for(var V=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Z(t,e)}(i,t);var e,n,a,r=K(i);function i(){return q(this,i),r.apply(this,arguments)}return e=i,(n=[{key:"_collectTransforms",value:function(t){var e=this,n=t.match(/\|([^|]+)/g).map((function(t){return H(J(i.prototype),"get",e).call(e,t.substring(1))}));return function(t){return n.reduce((function(t,e){return e(t)}),t)}}},{key:"get",value:function(t){return t?"|"===t.substring(0,1)?this._collectTransforms(t):H(J(i.prototype),"get",this).call(this,t):null}}])&&G(e.prototype,n),a&&G(e,a),i}(v)),Y=0,W=Object.entries(a);Y<W.length;Y++){var X=B(W[Y],2),Q=X[0],tt=X[1];V.add(Q,tt)}var et=V;function nt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var at=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var a=/^(?:([^:]+):)?([^:|]*)(\|.+)*$/.exec(e);this.full_name=e,this.namespace=a[1]||null,this.name=a[2]||null,this.transformations=[],"string"==typeof a[3]&&a[3].length>1&&(this.transformations=a[3].substring(1).split("|"),this.transformations.forEach((function(t,e){return n.transformations[e]=et.get(t)})))}var e,n,a;return e=t,(n=[{key:"_applyTransformations",value:function(t){return this.transformations.forEach((function(e){t=e(t)})),t}},{key:"resolve",value:function(t,e){if(void 0===t[this.full_name]){var n=null;void 0!==t["".concat(this.namespace,":").concat(this.name)]?n=t["".concat(this.namespace,":").concat(this.name)]:void 0!==t[this.name]?n=t[this.name]:e&&void 0!==e[this.full_name]&&(n=e[this.full_name]),t[this.full_name]=this._applyTransformations(n)}return t[this.full_name]}}])&&nt(e.prototype,n),a&&nt(e,a),t}(),rt=n(1);function it(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var ot=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._sources=e}var e,n,a;return e=t,(n=[{key:"__split_requests",value:function(t){var e={},n=/^(?:([^:]+):)?([^:|]*)(\|.+)*$/;return t.forEach((function(t){var a=n.exec(t),r=a[1]||"base",i=a[2],o=et.get(a[3]);void 0===e[r]&&(e[r]={outnames:[],fields:[],trans:[]}),e[r].outnames.push(t),e[r].fields.push(i),e[r].trans.push(o)})),e}},{key:"getData",value:function(t,e){for(var n=this,a=this.__split_requests(e),r=Object.keys(a).map((function(e){if(!n._sources.get(e))throw new Error("Datasource for namespace ".concat(e," not found"));return n._sources.get(e).getData(t,a[e].fields,a[e].outnames,a[e].trans)})),i=Promise.resolve({header:{},body:[],discrete:{}}),o=0;o<r.length;o++)i=i.then(r[o]);return i}}])&&it(e.prototype,n),a&&it(e,a),t}();function st(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function ct(t){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(){var t=this;return{showing:!1,selector:null,content_selector:null,hide_delay:null,show:function(e,n){return t.curtain.showing||(t.curtain.selector=A.select(t.parent_plot.svg.node().parentNode).insert("div").attr("class","lz-curtain").attr("id","".concat(t.id,".curtain")),t.curtain.content_selector=t.curtain.selector.append("div").attr("class","lz-curtain-content"),t.curtain.selector.append("div").attr("class","lz-curtain-dismiss").html("Dismiss").on("click",(function(){return t.curtain.hide()})),t.curtain.showing=!0),t.curtain.update(e,n)},update:function(e,n){if(!t.curtain.showing)return t.curtain;clearTimeout(t.curtain.hide_delay),"object"==ct(n)&&dt(t.curtain.selector,n);var a=t._getPageOrigin();return t.curtain.selector.style("top","".concat(a.y,"px")).style("left","".concat(a.x,"px")).style("width","".concat(t.layout.width,"px")).style("height","".concat(t.layout.height,"px")),t.curtain.content_selector.style("max-width","".concat(t.layout.width-40,"px")).style("max-height","".concat(t.layout.height-40,"px")),"string"==typeof e&&t.curtain.content_selector.html(e),t.curtain},hide:function(e){return t.curtain.showing?"number"==typeof e?(clearTimeout(t.curtain.hide_delay),t.curtain.hide_delay=setTimeout(t.curtain.hide,e),t.curtain):(t.curtain.selector.remove(),t.curtain.selector=null,t.curtain.content_selector=null,t.curtain.showing=!1,t.curtain):t.curtain}}}function ht(){var t=this;return{showing:!1,selector:null,content_selector:null,progress_selector:null,cancel_selector:null,show:function(e){return t.loader.showing||(t.loader.selector=A.select(t.parent_plot.svg.node().parentNode).insert("div").attr("class","lz-loader").attr("id","".concat(t.id,".loader")),t.loader.content_selector=t.loader.selector.append("div").attr("class","lz-loader-content"),t.loader.progress_selector=t.loader.selector.append("div").attr("class","lz-loader-progress-container").append("div").attr("class","lz-loader-progress"),t.loader.showing=!0,void 0===e&&(e="Loading...")),t.loader.update(e)},update:function(e,n){if(!t.loader.showing)return t.loader;clearTimeout(t.loader.hide_delay),"string"==typeof e&&t.loader.content_selector.html(e);var a=t._getPageOrigin(),r=t.loader.selector.node().getBoundingClientRect();return t.loader.selector.style("top","".concat(a.y+t.layout.height-r.height-6,"px")).style("left","".concat(a.x+6,"px")),"number"==typeof n&&t.loader.progress_selector.style("width","".concat(Math.min(Math.max(n,1),100),"%")),t.loader},animate:function(){return t.loader.progress_selector.classed("lz-loader-progress-animated",!0),t.loader},setPercentCompleted:function(e){return t.loader.progress_selector.classed("lz-loader-progress-animated",!1),t.loader.update(null,e)},hide:function(e){return t.loader.showing?"number"==typeof e?(clearTimeout(t.loader.hide_delay),t.loader.hide_delay=setTimeout(t.loader.hide,e),t.loader):(t.loader.selector.remove(),t.loader.selector=null,t.loader.content_selector=null,t.loader.progress_selector=null,t.loader.cancel_selector=null,t.loader.showing=!1,t.loader):t.loader}}}function dt(t,e){e=e||{};for(var n=0,a=Object.entries(e);n<a.length;n++){var r=st(a[n],2),i=r[0],o=r[1];t.style(i,o)}}function pt(t,e,n){return(pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wt(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return yt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mt(t,e)}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=wt(t);if(e){var r=wt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return bt(this,n)}}function bt(t,e){return!e||"object"!==_t(e)&&"function"!=typeof e?xt(t):e}function xt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Ot(t,e,n){return e&&St(t.prototype,e),n&&St(t,n),t}var zt=function(){function t(e,n){kt(this,t),this.layout=e||{},this.layout.color||(this.layout.color="gray"),this.parent=n||null,this.parent_panel=null,this.parent_plot=null,this.parent_svg=null,this.parent&&("panel"===this.parent.type?(this.parent_panel=this.parent.parent,this.parent_plot=this.parent.parent.parent,this.parent_svg=this.parent_panel):(this.parent_plot=this.parent.parent,this.parent_svg=this.parent_plot)),this.selector=null,this.button=null,this.persist=!1,this.layout.position||(this.layout.position="left")}return Ot(t,[{key:"show",value:function(){if(this.parent&&this.parent.selector){if(!this.selector){var t=["start","middle","end"].includes(this.layout.group_position)?" lz-toolbar-group-".concat(this.layout.group_position):"";this.selector=this.parent.selector.append("div").attr("class","lz-toolbar-".concat(this.layout.position).concat(t)),this.layout.style&&dt(this.selector,this.layout.style),"function"==typeof this.initialize&&this.initialize()}return this.button&&"highlighted"===this.button.status&&this.button.menu.show(),this.selector.style("visibility","visible"),this.update(),this.position()}}},{key:"update",value:function(){}},{key:"position",value:function(){return this.button&&this.button.menu.position(),this}},{key:"shouldPersist",value:function(){return!!this.persist||!(!this.button||!this.button.persist)}},{key:"hide",value:function(){return!this.selector||this.shouldPersist()||(this.button&&this.button.menu.hide(),this.selector.style("visibility","hidden")),this}},{key:"destroy",value:function(t){return void 0===t&&(t=!1),this.selector?(this.shouldPersist()&&!t||(this.button&&this.button.menu&&this.button.menu.destroy(),this.selector.remove(),this.selector=null,this.button=null),this):this}}]),t}(),Et=function(){function t(e){var n=this;if(kt(this,t),!(e instanceof zt))throw new Error("Unable to create toolbar widget button, invalid parent");this.parent=e,this.parent_panel=this.parent.parent_panel,this.parent_plot=this.parent.parent_plot,this.parent_svg=this.parent.parent_svg,this.parent_toolbar=this.parent.parent,this.selector=null,this.tag="a",this.html="",this.title="",this.color="gray",this.style={},this.persist=!1,this.permanent=!1,this.status="",this.menu={outer_selector:null,inner_selector:null,scroll_position:0,hidden:!0,show:function(){return n.menu.outer_selector||(n.menu.outer_selector=A.select(n.parent_plot.svg.node().parentNode).append("div").attr("class","lz-toolbar-menu lz-toolbar-menu-".concat(n.color)).attr("id","".concat(n.parent_svg.getBaseId(),".toolbar.menu")),n.menu.inner_selector=n.menu.outer_selector.append("div").attr("class","lz-toolbar-menu-content"),n.menu.inner_selector.on("scroll",(function(){n.menu.scroll_position=n.menu.inner_selector.node().scrollTop}))),n.menu.outer_selector.style("visibility","visible"),n.menu.hidden=!1,n.menu.update()},update:function(){return n.menu.outer_selector?(n.menu.populate(),n.menu.inner_selector&&(n.menu.inner_selector.node().scrollTop=n.menu.scroll_position),n.menu.position()):n.menu},position:function(){if(!n.menu.outer_selector)return n.menu;n.menu.outer_selector.style("height",null);var t,e,a=n.parent_svg._getPageOrigin(),r=document.documentElement.scrollTop||document.body.scrollTop,i=n.parent_plot.getContainerOffset(),o=n.parent_toolbar.selector.node().getBoundingClientRect(),s=n.selector.node().getBoundingClientRect(),l=n.menu.outer_selector.node().getBoundingClientRect(),c=n.menu.inner_selector.node().scrollHeight;"panel"===n.parent_toolbar.type?(t=a.y+o.height+6,e=Math.max(a.x+n.parent_svg.layout.width-l.width-3,a.x+3)):(t=s.bottom+r+3-i.top,e=Math.max(s.left+s.width-l.width-i.left,a.x+3));var u=Math.max(n.parent_svg.layout.width-6-20,20),h=u,d=u-12,p=Math.max(n.parent_svg.layout.height-30-14,14),f=Math.min(c,p);return n.menu.outer_selector.style("top","".concat(t,"px")).style("left","".concat(e,"px")).style("max-width","".concat(h,"px")).style("max-height","".concat(p,"px")).style("height","".concat(f,"px")),n.menu.inner_selector.style("max-width","".concat(d,"px")),n.menu.inner_selector.node().scrollTop=n.menu.scroll_position,n.menu},hide:function(){return n.menu.outer_selector?(n.menu.outer_selector.style("visibility","hidden"),n.menu.hidden=!0,n.menu):n.menu},destroy:function(){return n.menu.outer_selector?(n.menu.inner_selector.remove(),n.menu.outer_selector.remove(),n.menu.inner_selector=null,n.menu.outer_selector=null,n.menu):n.menu},populate:function(){throw new Error("Method must be implemented")},setPopulate:function(t){return"function"==typeof t?(n.menu.populate=t,n.setOnclick((function(){n.menu.hidden?(n.menu.show(),n.highlight().update(),n.persist=!0):(n.menu.hide(),n.highlight(!1).update(),n.permanent||(n.persist=!1))}))):n.setOnclick(),n}}}return Ot(t,[{key:"setColor",value:function(t){return void 0!==t&&(["gray","red","orange","yellow","green","blue","purple"].includes(t)?this.color=t:this.color="gray"),this}},{key:"setPermanent",value:function(t){return t=void 0===t||Boolean(t),this.permanent=t,this.permanent&&(this.persist=!0),this}},{key:"shouldPersist",value:function(){return this.permanent||this.persist}},{key:"setStyle",value:function(t){return void 0!==t&&(this.style=t),this}},{key:"getClass",value:function(){var t=["start","middle","end"].includes(this.parent.layout.group_position)?" lz-toolbar-button-group-".concat(this.parent.layout.group_position):"";return"lz-toolbar-button lz-toolbar-button-".concat(this.color).concat(this.status?"-".concat(this.status):"").concat(t)}},{key:"setStatus",value:function(t){return void 0!==t&&["","highlighted","disabled"].includes(t)&&(this.status=t),this.update()}},{key:"highlight",value:function(t){return(t=void 0===t||Boolean(t))?this.setStatus("highlighted"):"highlighted"===this.status?this.setStatus(""):this}},{key:"disable",value:function(t){return(t=void 0===t||Boolean(t))?this.setStatus("disabled"):"disabled"===this.status?this.setStatus(""):this}},{key:"onmouseover",value:function(){}},{key:"setOnMouseover",value:function(t){return this.onmouseover="function"==typeof t?t:function(){},this}},{key:"onmouseout",value:function(){}},{key:"setOnMouseout",value:function(t){return this.onmouseout="function"==typeof t?t:function(){},this}},{key:"onclick",value:function(){}},{key:"setOnclick",value:function(t){return this.onclick="function"==typeof t?t:function(){},this}},{key:"setTitle",value:function(t){return void 0!==t&&(this.title=t.toString()),this}},{key:"setHtml",value:function(t){return void 0!==t&&(this.html=t.toString()),this}},{key:"show",value:function(){if(this.parent)return this.selector||(this.selector=this.parent.selector.append(this.tag).attr("class",this.getClass())),this.update()}},{key:"preUpdate",value:function(){return this}},{key:"update",value:function(){return this.selector?(this.preUpdate(),this.selector.attr("class",this.getClass()).attr("title",this.title).on("mouseover","disabled"===this.status?null:this.onmouseover).on("mouseout","disabled"===this.status?null:this.onmouseout).on("click","disabled"===this.status?null:this.onclick).html(this.html).call(dt,this.style),this.menu.update(),this.postUpdate(),this):this}},{key:"postUpdate",value:function(){return this}},{key:"hide",value:function(){return this.selector&&!this.shouldPersist()&&(this.selector.remove(),this.selector=null),this}}]),t}(),jt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"show",value:function(){return this.div_selector||(this.div_selector=this.parent.selector.append("div").attr("class","lz-toolbar-title lz-toolbar-".concat(this.layout.position)),this.title_selector=this.div_selector.append("h3")),this.update()}},{key:"update",value:function(){var t=this.layout.title.toString();return this.layout.subtitle&&(t+=" <small>".concat(this.layout.subtitle,"</small>")),this.title_selector.html(t),this}}]),n}(zt),Mt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this.parent_plot.layout.width.toString().includes(".")?this.parent_plot.layout.width.toFixed(2):this.parent_plot.layout.width,e=this.parent_plot.layout.height.toString().includes(".")?this.parent_plot.layout.height.toFixed(2):this.parent_plot.layout.height;return this.selector.html("".concat(t,"px × ").concat(e,"px")),this.layout.class&&this.selector.attr("class",this.layout.class),this.layout.style&&dt(this.selector,this.layout.style),this}}]),n}(zt),Pt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){return isNaN(this.parent_plot.state.start)||isNaN(this.parent_plot.state.end)||null===this.parent_plot.state.start||null===this.parent_plot.state.end?this.selector.style("display","none"):(this.selector.style("display",null),this.selector.html(ge(this.parent_plot.state.end-this.parent_plot.state.start,null,!0))),this.layout.class&&this.selector.attr("class",this.layout.class),this.layout.style&&dt(this.selector,this.layout.style),this}}]),n}(zt),At=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;if(kt(this,n),!(r=e.call(this,t,a)).parent_panel)throw new Error("Filter widget can only be used in panel toolbars");if(r._data_layer=r.parent_panel.data_layers[t.layer_name],!r._data_layer)throw new Error("Filter widget could not locate the specified layer_name: '".concat(t.layer_name,"'"));if(r._field=t.field,r._field_display_html=t.field_display_html,r._operator=t.operator,r._filter_id=null,r._data_type=t.data_type||"number",!["number","string"].includes(r._data_type))throw new Error("Filter must be either string or number");return r._value_selector=null,r}return Ot(n,[{key:"_getTarget",value:function(){var t=this;this._data_layer.layout.filters||(this._data_layer.layout.filters=[]);var e=this._data_layer.layout.filters.find((function(e){return e.field===t._field&&e.operator===t._operator&&(!t._filter_id||e.id===t._filter_id)}));return e||(e={field:this._field,operator:this._operator,value:null},this._filter_id&&(e.id=this._filter_id),this._data_layer.layout.filters.push(e)),e}},{key:"_clearFilter",value:function(){if(this._data_layer.layout.filters){var t=this._data_layer.layout.filters.indexOf(this._getTarget());this._data_layer.layout.filters.splice(t,1)}}},{key:"_setFilter",value:function(t){null===t?(this._value_selector.style("border","1px solid red").style("color","red"),this._clearFilter()):this._getTarget().value=t}},{key:"_getValue",value:function(){var t=this._value_selector.property("value");return null===t||""===t||"number"===this._data_type&&(t=+t,Number.isNaN(t))?null:t}},{key:"update",value:function(){var t=this;this._value_selector||(this.selector.style("padding","0 6px"),this.selector.append("span").html(this._field_display_html).style("background","#fff").style("padding-left","3px"),this.selector.append("span").text(this._operator).style("padding","0 3px").style("background","#fff"),this._value_selector=this.selector.append("input").attr("size",this.layout.input_size||4).on("input",function(t){var e,n=arguments,a=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){clearTimeout(e),e=setTimeout((function(){return t.apply(a,n)}),r)}}((function(){t._value_selector.style("border",null).style("color",null);var e=t._getValue();t._setFilter(e),t.parent_panel.render()}),750)))}}]),n}(zt),Rt=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;return kt(this,n),(r=e.call(this,t,a))._filename=r.layout.filename||"locuszoom.svg",r._button_html=r.layout.button_html||"Save SVG",r._button_title=r.layout.button_title||"Download hi-res image",r}return Ot(n,[{key:"update",value:function(){var t=this;return this.button||(this.button=new Et(this).setColor(this.layout.color).setHtml(this._button_html).setTitle(this._button_title).setOnMouseover((function(){t.button.selector.classed("lz-toolbar-button-gray-disabled",!0).html("Preparing Image"),t._getBlobUrl().then((function(e){var n=t.button.selector.attr("href");n&&URL.revokeObjectURL(n),t.button.selector.attr("href",e).classed("lz-toolbar-button-gray-disabled",!1).classed("lz-toolbar-button-gray-highlighted",!0).html(t._button_html)}))})).setOnMouseout((function(){t.button.selector.classed("lz-toolbar-button-gray-highlighted",!1)})),this.button.show(),this.button.selector.attr("href-lang","image/svg+xml").attr("download",this._filename)),this}},{key:"_getCSS",value:function(t){for(var e=/^svg\.lz-locuszoom\s*/,n="",a=0;a<document.styleSheets.length;a++){var r=document.styleSheets[a];try{if(!r.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var i=r.cssRules,o=0;o<i.length;o++){var s=i[o];s.selectorText&&s.selectorText.match(e)&&(n+=s.cssText)}}return n}},{key:"_appendCSS",value:function(t,e){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=t;var a=e.hasChildNodes()?e.children[0]:null;e.insertBefore(n,a)}},{key:"_getDimensions",value:function(){var t=this.parent_plot.svg.node().getBoundingClientRect(),e=t.width,n=2400/e;return[n*e,n*t.height]}},{key:"_generateSVG",value:function(){var t=this;return new Promise((function(e){var n=t.parent_plot.svg.node().cloneNode(!0);n.setAttribute("xlink","http://www.w3.org/1999/xlink"),(n=A.select(n)).selectAll("g.lz-curtain").remove(),n.selectAll("g.lz-mouse_guide").remove(),n.selectAll("g.tick text").each((function(){var t=10*+A.select(this).attr("dy").substring(-2).slice(0,-2);A.select(this).attr("dy",t)}));var a=new XMLSerializer;n=n.node();var r=ft(t._getDimensions(),2),i=r[0],o=r[1];n.setAttribute("width",i),n.setAttribute("height",o),t._appendCSS(t._getCSS(n),n),e(a.serializeToString(n))}))}},{key:"_getBlobUrl",value:function(){return this._generateSVG().then((function(t){var e=new Blob([t],{type:"image/svg+xml"});return URL.createObjectURL(e)}))}}]),n}(zt),Nt=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;return kt(this,n),(r=e.apply(this,arguments))._filename=r.layout.filename||"locuszoom.png",r._button_html=r.layout.button_html||"Save PNG",r._button_title=r.layout.button_title||"Download image",r}return Ot(n,[{key:"_getBlobUrl",value:function(){var t=this;return pt(wt(n.prototype),"_getBlobUrl",this).call(this).then((function(e){var n=document.createElement("canvas"),a=n.getContext("2d"),r=ft(t._getDimensions(),2),i=r[0],o=r[1];return n.width=i,n.height=o,new Promise((function(t,r){var s=new Image;s.onload=function(){a.drawImage(s,0,0,i,o),URL.revokeObjectURL(e),n.toBlob((function(e){t(URL.createObjectURL(e))}))},s.src=e}))}))}}]),n}(Rt),Tt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this;return this.button||(this.button=new Et(this).setColor(this.layout.color).setHtml("×").setTitle("Remove panel").setOnclick((function(){if(!t.layout.suppress_confirm&&!confirm("Are you sure you want to remove this panel? This cannot be undone."))return!1;var e=t.parent_panel;return e.toolbar.hide(!0),A.select(e.parent.svg.node().parentNode).on("mouseover.".concat(e.getBaseId(),".toolbar"),null),A.select(e.parent.svg.node().parentNode).on("mouseout.".concat(e.getBaseId(),".toolbar"),null),e.parent.removePanel(e.id)})),this.button.show()),this}}]),n}(zt),It=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this;if(this.button){var e=0===this.parent_panel.layout.y_index;return this.button.disable(e),this}return this.button=new Et(this).setColor(this.layout.color).setHtml("▴").setTitle("Move panel up").setOnclick((function(){t.parent_panel.moveUp(),t.update()})),this.button.show(),this.update()}}]),n}(zt),Dt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this;if(this.button){var e=this.parent_panel.layout.y_index===this.parent_plot.panel_ids_by_y_index.length-1;return this.button.disable(e),this}return this.button=new Et(this).setColor(this.layout.color).setHtml("▾").setTitle("Move panel down").setOnclick((function(){t.parent_panel.moveDown(),t.update()})),this.button.show(),this.update()}}]),n}(zt),Ct=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;if(kt(this,n),(isNaN(t.step)||0===t.step)&&(t.step=5e4),"string"!=typeof t.button_html&&(t.button_html=t.step>0?">":"<"),"string"!=typeof t.button_title&&(t.button_title="Shift region by ".concat(t.step>0?"+":"-").concat(ge(Math.abs(t.step),null,!0))),r=e.call(this,t,a),isNaN(r.parent_plot.state.start)||isNaN(r.parent_plot.state.end))throw new Error("Unable to add shift_region toolbar widget: plot state does not have region bounds");return r}return Ot(n,[{key:"update",value:function(){var t=this;return this.button||(this.button=new Et(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title).setOnclick((function(){t.parent_plot.applyState({start:Math.max(t.parent_plot.state.start+t.layout.step,1),end:t.parent_plot.state.end+t.layout.step})})),this.button.show()),this}}]),n}(zt),Lt=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;if(kt(this,n),(isNaN(t.step)||0===t.step)&&(t.step=.2),"string"!=typeof t.button_html&&(t.button_html=t.step>0?"z–":"z+"),"string"!=typeof t.button_title&&(t.button_title="Zoom region ".concat(t.step>0?"out":"in"," by ").concat((100*Math.abs(t.step)).toFixed(1),"%")),r=e.call(this,t,a),isNaN(r.parent_plot.state.start)||isNaN(r.parent_plot.state.end))throw new Error("Unable to add zoom_region toolbar widget: plot state does not have region bounds");return r}return Ot(n,[{key:"update",value:function(){var t=this;if(this.button){var e=!0,n=this.parent_plot.state.end-this.parent_plot.state.start;return this.layout.step>0&&!isNaN(this.parent_plot.layout.max_region_scale)&&n>=this.parent_plot.layout.max_region_scale&&(e=!1),this.layout.step<0&&!isNaN(this.parent_plot.layout.min_region_scale)&&n<=this.parent_plot.layout.min_region_scale&&(e=!1),this.button.disable(!e),this}return this.button=new Et(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title).setOnclick((function(){var e=t.parent_plot.state.end-t.parent_plot.state.start,n=e*(1+t.layout.step);isNaN(t.parent_plot.layout.max_region_scale)||(n=Math.min(n,t.parent_plot.layout.max_region_scale)),isNaN(t.parent_plot.layout.min_region_scale)||(n=Math.max(n,t.parent_plot.layout.min_region_scale));var a=Math.floor((n-e)/2);t.parent_plot.applyState({start:Math.max(t.parent_plot.state.start-a,1),end:t.parent_plot.state.end+a})})),this.button.show(),this}}]),n}(zt),Bt=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this;return this.button||(this.button=new Et(this).setColor(this.layout.color).setHtml(this.layout.button_html).setTitle(this.layout.button_title),this.button.menu.setPopulate((function(){t.button.menu.inner_selector.html(t.layout.menu_html)})),this.button.show()),this}}]),n}(zt),Ut=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this;return this.button||(this.button=new Et(this).setColor(this.layout.color).setHtml(this.layout.button_html||"Resize to Data").setTitle(this.layout.button_title||"Automatically resize this panel to show all data available").setOnclick((function(){t.parent_panel.scaleHeightToData(),t.update()})),this.button.show()),this}}]),n}(zt),Ft=function(t){gt(n,t);var e=vt(n);function n(){return kt(this,n),e.apply(this,arguments)}return Ot(n,[{key:"update",value:function(){var t=this,e=this.parent_panel.legend.layout.hidden?"Show Legend":"Hide Legend";return this.button?(this.button.setHtml(e).show(),this.parent.position(),this):(this.button=new Et(this).setColor(this.layout.color).setTitle("Show or hide the legend for this panel").setOnclick((function(){t.parent_panel.legend.layout.hidden=!t.parent_panel.legend.layout.hidden,t.parent_panel.legend.render(),t.update()})),this.update())}}]),n}(zt),qt=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;kt(this,n),"string"!=typeof t.button_html&&(t.button_html="Display options..."),"string"!=typeof t.button_title&&(t.button_title="Control how plot items are displayed"),r=e.apply(this,arguments);var i=t.fields_whitelist||["color","fill_opacity","filters","label","legend","point_shape","point_size","tooltip","tooltip_positioning"],o=r.parent_panel.data_layers[t.layer_name];if(!o)throw new Error("Display options could not locate the specified layer_name: '".concat(t.layer_name,"'"));var s=o.layout,l={};return i.forEach((function(t){var e=s[t];void 0!==e&&(l[t]=Object(rt.b)(e))})),r._selected_item="default",r.button=new Et(xt(r)).setColor(t.color).setHtml(t.button_html).setTitle(t.button_title).setOnclick((function(){r.button.menu.populate()})),r.button.menu.setPopulate((function(){var t=Math.floor(1e4*Math.random()).toString();r.button.menu.inner_selector.html("");var e=r.button.menu.inner_selector.append("table"),n=r.layout,a=function(n,a,s){var c=e.append("tr"),u="".concat(t).concat(s);c.append("td").append("input").attr("id",u).attr("type","radio").attr("name","display-option-".concat(t)).attr("value",s).style("margin",0).property("checked",s===r._selected_item).on("click",(function(){i.forEach((function(t){var e=void 0!==a[t];o.layout[t]=e?a[t]:l[t]})),r._selected_item=s,r.parent_panel.render();var t=r.parent_panel.legend;t&&t.render()})),c.append("td").append("label").style("font-weight","normal").attr("for",u).text(n)},s=n.default_config_display_name||"Default style";return a(s,l,"default"),n.options.forEach((function(t,e){return a(t.display_name,t.display,e)})),xt(r)})),r}return Ot(n,[{key:"update",value:function(){return this.button.show(),this}}]),n}(zt),Gt=function(t){gt(n,t);var e=vt(n);function n(t,a){var r;if(kt(this,n),"string"!=typeof t.button_html&&(t.button_html="Set option..."),"string"!=typeof t.button_title&&(t.button_title="Choose an option to customize the plot"),(r=e.call(this,t,a)).parent_panel)throw new Error("This widget is designed to set global options, so it can only be used at the top (plot) level");if(!t.state_field)throw new Error("Must specify the `state_field` that this widget controls");if(r._selected_item=r.parent_plot.state[t.state_field]||t.options[0].value,!t.options.find((function(t){return t.value===r._selected_item})))throw new Error("There is an existing state value that does not match the known values in this widget");return r.button=new Et(xt(r)).setColor(t.color).setHtml(t.button_html+(t.show_selected?r._selected_item:"")).setTitle(t.button_title).setOnclick((function(){r.button.menu.populate()})),r.button.menu.setPopulate((function(){var e=Math.floor(1e4*Math.random()).toString();r.button.menu.inner_selector.html("");var n=r.button.menu.inner_selector.append("table");return t.options.forEach((function(a,i){return o=a.display_name,s=a.value,l=i,c=n.append("tr"),u="".concat(e).concat(l),c.append("td").append("input").attr("id",u).attr("type","radio").attr("name","set-state-".concat(e)).attr("value",l).style("margin",0).property("checked",s===r._selected_item).on("click",(function(){var e={};e[t.state_field]=s,r._selected_item=s,r.parent_plot.applyState(e),r.button.setHtml(t.button_html+(t.show_selected?r._selected_item:""))})),void c.append("td").append("label").style("font-weight","normal").attr("for",u).text(o);var o,s,l,c,u})),xt(r)})),r}return Ot(n,[{key:"update",value:function(){return this.button.show(),this}}]),n}(zt);function Ht(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}for(var Kt=new b,$t=0,Jt=Object.entries(r);$t<Jt.length;$t++){var Vt=Ht(Jt[$t],2),Yt=Vt[0],Wt=Vt[1];Kt.add(Yt,Wt)}var Xt=Kt;function Qt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var te=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.parent=e,this.id="".concat(this.parent.getBaseId(),".toolbar"),this.type=this.parent.parent?"panel":"plot",this.parent_plot=this.parent.parent_plot,this.selector=null,this.widgets=[],this.hide_timeout=null,this.persist=!1,this.initialize()}var e,n,a;return e=t,(n=[{key:"initialize",value:function(){var t=this,e=this.parent.layout.dashboard&&this.parent.layout.dashboard.components||this.parent.layout.toolbar.widgets;return Array.isArray(e)&&e.forEach((function(e){try{var n=Xt.create(e.type,e,t);t.widgets.push(n)}catch(t){console.warn("Failed to create widget"),console.error(t)}})),"panel"===this.type&&A.select(this.parent.parent.svg.node().parentNode).on("mouseover.".concat(this.id),(function(){clearTimeout(t.hide_timeout),t.selector&&"hidden"!==t.selector.style("visibility")||t.show()})).on("mouseout.".concat(this.id),(function(){clearTimeout(t.hide_timeout),t.hide_timeout=setTimeout((function(){t.hide()}),300)})),this}},{key:"shouldPersist",value:function(){if(this.persist)return!0;var t=!1;return this.widgets.forEach((function(e){t=t||e.shouldPersist()})),!!(t=t||this.parent_plot.panel_boundaries.dragging||this.parent_plot.interaction.dragging)}},{key:"show",value:function(){if(!this.selector){switch(this.type){case"plot":this.selector=A.select(this.parent.svg.node().parentNode).insert("div",":first-child");break;case"panel":this.selector=A.select(this.parent.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip, .lz-toolbar-menu, .lz-curtain").classed("lz-panel-toolbar",!0);break;default:throw new Error("Toolbar cannot be a child of ".concat(this.type))}this.selector.classed("lz-toolbar",!0).classed("lz-".concat(this.type,"-toolbar"),!0).attr("id",this.id)}return this.widgets.forEach((function(t){return t.show()})),this.selector.style("visibility","visible"),this.update()}},{key:"update",value:function(){return this.selector?(this.widgets.forEach((function(t){return t.update()})),this.position()):this}},{key:"position",value:function(){if(!this.selector)return this;if("panel"===this.type){var t=this.parent._getPageOrigin(),e="".concat((t.y+3.5).toString(),"px"),n="".concat(t.x.toString(),"px"),a="".concat((this.parent.layout.width-4).toString(),"px");this.selector.style("position","absolute").style("top",e).style("left",n).style("width",a)}return this.widgets.forEach((function(t){return t.position()})),this}},{key:"hide",value:function(){return!this.selector||this.shouldPersist()||(this.widgets.forEach((function(t){return t.hide()})),this.selector.style("visibility","hidden")),this}},{key:"destroy",value:function(t){return void 0===t&&(t=!1),this.selector?(this.shouldPersist()&&!t||(this.widgets.forEach((function(t){return t.destroy(!0)})),this.widgets=[],this.selector.remove(),this.selector=null),this):this}}])&&Qt(e.prototype,n),a&&Qt(e,a),t}();function ee(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var ne={orientation:"vertical",origin:{x:0,y:0},width:10,height:10,padding:5,label_size:12,hidden:!1},ae=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.parent=e,this.id="".concat(this.parent.getBaseId(),".legend"),this.parent.layout.legend=Object(rt.c)(this.parent.layout.legend||{},ne),this.layout=this.parent.layout.legend,this.selector=null,this.background_rect=null,this.elements=[],this.elements_group=null,this.hidden=!1,this.render()}var e,n,a;return e=t,(n=[{key:"render",value:function(){var t=this;this.selector||(this.selector=this.parent.svg.group.append("g").attr("id","".concat(this.parent.getBaseId(),".legend")).attr("class","lz-legend")),this.background_rect||(this.background_rect=this.selector.append("rect").attr("width",100).attr("height",100).attr("class","lz-legend-background")),this.elements_group||(this.elements_group=this.selector.append("g")),this.elements.forEach((function(t){return t.remove()})),this.elements=[];var e=+this.layout.padding||1,n=e,a=e,r=0;this.parent.data_layer_ids_by_z_index.slice().reverse().forEach((function(i){Array.isArray(t.parent.data_layers[i].layout.legend)&&t.parent.data_layers[i].layout.legend.forEach((function(i){var o=t.elements_group.append("g").attr("transform","translate(".concat(n,", ").concat(a,")")),s=+i.label_size||+t.layout.label_size||12,l=0,c=s/2+e/2;r=Math.max(r,s+e);var u=i.shape||"",h=Object(rt.d)(u);if("line"===u){var d=+i.length||16,p=s/4+e/2;o.append("path").attr("class",i.class||"").attr("d","M0,".concat(p,"L").concat(d,",").concat(p)).call(dt,i.style||{}),l=d+e}else if("rect"===u){var f=+i.width||16,y=+i.height||f;o.append("rect").attr("class",i.class||"").attr("width",f).attr("height",y).attr("fill",i.color||{}).call(dt,i.style||{}),l=f+e,r=Math.max(r,y+e)}else if(h){var _=+i.size||40,g=Math.ceil(Math.sqrt(_/Math.PI));o.append("path").attr("class",i.class||"").attr("d",A.symbol().size(_).type(h)).attr("transform","translate(".concat(g,", ").concat(g+e/2,")")).attr("fill",i.color||{}).call(dt,i.style||{}),l=2*g+e,c=Math.max(2*g+e/2,c),r=Math.max(r,2*g+e)}o.append("text").attr("text-anchor","left").attr("class","lz-label").attr("x",l).attr("y",c).style("font-size",s).text(i.label);var m=o.node().getBoundingClientRect();if("vertical"===t.layout.orientation)a+=m.height+e,r=0;else{var v=t.layout.origin.x+n+m.width;n>e&&v>t.parent.layout.width&&(a+=r,n=e,o.attr("transform","translate(".concat(n,", ").concat(a,")"))),n+=m.width+3*e}t.elements.push(o)}))}));var i=this.elements_group.node().getBoundingClientRect();return this.layout.width=i.width+2*this.layout.padding,this.layout.height=i.height+2*this.layout.padding,this.background_rect.attr("width",this.layout.width).attr("height",this.layout.height),this.selector.style("visibility",this.layout.hidden?"hidden":"visible"),this.position()}},{key:"position",value:function(){if(!this.selector)return this;var t=this.selector.node().getBoundingClientRect();isNaN(+this.layout.pad_from_bottom)||(this.layout.origin.y=this.parent.layout.height-t.height-+this.layout.pad_from_bottom),isNaN(+this.layout.pad_from_right)||(this.layout.origin.x=this.parent.layout.width-t.width-+this.layout.pad_from_right),this.selector.attr("transform","translate(".concat(this.layout.origin.x,", ").concat(this.layout.origin.y,")"))}},{key:"hide",value:function(){this.layout.hidden=!0,this.render()}},{key:"show",value:function(){this.layout.hidden=!1,this.render()}}])&&ee(e.prototype,n),a&&ee(e,a),t}();function re(t){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ie(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var oe={title:{text:"",style:{},x:10,y:22},y_index:null,width:0,height:0,origin:{x:0,y:null},min_width:1,min_height:1,proportional_width:null,proportional_height:null,proportional_origin:{x:0,y:null},margin:{top:0,right:0,bottom:0,left:0},background_click:"clear_selections",toolbar:{widgets:[]},cliparea:{height:0,width:0,origin:{x:0,y:0}},axes:{x:{},y1:{},y2:{}},legend:null,interaction:{drag_background_to_pan:!1,drag_x_ticks_to_scale:!1,drag_y1_ticks_to_scale:!1,drag_y2_ticks_to_scale:!1,scroll_to_zoom:!1,x_linked:!1,y1_linked:!1,y2_linked:!1},data_layers:[]},se=function(){function t(e,n){var a=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==re(e))throw new Error("Unable to create panel, invalid layout");if(this.parent=n||null,this.parent_plot=n,"string"==typeof e.id&&e.id.length){if(this.parent&&void 0!==this.parent.panels[e.id])throw new Error("Cannot create panel with id [".concat(e.id,"]; panel with that id already exists"))}else if(this.parent){e.id=function t(){var e="p".concat(Math.floor(Math.random()*Math.pow(10,8)));return null!==e&&void 0===a.parent.panels[e]||(e=t()),e}()}else e.id="p".concat(Math.floor(Math.random()*Math.pow(10,8)));this.id=e.id,this.initialized=!1,this.layout_idx=null,this.svg={},this.layout=Object(rt.c)(e||{},oe),this.parent?(this.state=this.parent.state,this.state_id=this.id,this.state[this.state_id]=this.state[this.state_id]||{}):(this.state=null,this.state_id=null),this.data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.x_scale=null,this.y1_scale=null,this.y2_scale=null,this.x_extent=null,this.y1_extent=null,this.y2_extent=null,this.x_ticks=[],this.y1_ticks=[],this.y2_ticks=[],this.zoom_timeout=null,this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[],element_selection:[],match_requested:[]},this.initializeLayout()}var e,n,a;return e=t,(n=[{key:"on",value:function(t,e){if(!Array.isArray(this.event_hooks[t]))throw new Error("Unable to register event hook, invalid event: ".concat(t.toString()));if("function"!=typeof e)throw new Error("Unable to register event hook, invalid hook function passed");return this.event_hooks[t].push(e),e}},{key:"off",value:function(t,e){var n=this.event_hooks[t];if(!Array.isArray(n))throw new Error("Unable to remove event hook, invalid event: ".concat(t.toString()));if(void 0===e)this.event_hooks[t]=[];else{var a=n.indexOf(e);if(-1===a)throw new Error("The specified event listener is not registered and therefore cannot be removed");n.splice(a,1)}return this}},{key:"emit",value:function(t,e,n){var a=this;if(n=n||!1,!Array.isArray(this.event_hooks[t]))throw new Error("LocusZoom attempted to throw an invalid event: ".concat(t.toString()));"boolean"==typeof e&&2===arguments.length&&(n=e,e=null);var r=this.getBaseId(),i={sourceID:r,target:this,data:e||null};return this.event_hooks[t].forEach((function(t){t.call(a,i)})),n&&this.parent&&this.parent.emit(t,i),this}},{key:"setTitle",value:function(t){if("string"==typeof this.layout.title){var e=this.layout.title;this.layout.title={text:e,x:0,y:0,style:{}}}return"string"==typeof t?this.layout.title.text=t:"object"==re(t)&&null!==t&&(this.layout.title=Object(rt.c)(t,this.layout.title)),this.layout.title.text.length?this.title.attr("display",null).attr("x",parseFloat(this.layout.title.x)).attr("y",parseFloat(this.layout.title.y)).text(this.layout.title.text).call(dt,this.layout.title.style):this.title.attr("display","none"),this}},{key:"addDataLayer",value:function(t){var e=this;if("object"!==re(t)||"string"!=typeof t.id||!t.id.length)throw new Error("Invalid data layer layout");if(void 0!==this.data_layers[t.id])throw new Error("Cannot create data_layer with id [".concat(t.id,"]; data layer with that id already exists in the panel"));if("string"!=typeof t.type)throw new Error("Invalid data layer type");"object"!=re(t.y_axis)||void 0!==t.y_axis.axis&&[1,2].includes(t.y_axis.axis)||(t.y_axis.axis=1);var n=ia.create(t.type,t,this);if(this.data_layers[n.id]=n,null!==n.layout.z_index&&!isNaN(n.layout.z_index)&&this.data_layer_ids_by_z_index.length>0)n.layout.z_index<0&&(n.layout.z_index=Math.max(this.data_layer_ids_by_z_index.length+n.layout.z_index,0)),this.data_layer_ids_by_z_index.splice(n.layout.z_index,0,n.id),this.data_layer_ids_by_z_index.forEach((function(t,n){e.data_layers[t].layout.z_index=n}));else{var a=this.data_layer_ids_by_z_index.push(n.id);this.data_layers[n.id].layout.z_index=a-1}var r=null;return this.layout.data_layers.forEach((function(t,e){t.id===n.id&&(r=e)})),null===r&&(r=this.layout.data_layers.push(this.data_layers[n.id].layout)-1),this.data_layers[n.id].layout_idx=r,this.data_layers[n.id]}},{key:"removeDataLayer",value:function(t){var e=this;if(!this.data_layers[t])throw new Error("Unable to remove data layer, ID not found: ".concat(t));return this.data_layers[t].destroyAllTooltips(),this.data_layers[t].svg.container&&this.data_layers[t].svg.container.remove(),this.layout.data_layers.splice(this.data_layers[t].layout_idx,1),delete this.state[this.data_layers[t].state_id],delete this.data_layers[t],this.data_layer_ids_by_z_index.splice(this.data_layer_ids_by_z_index.indexOf(t),1),this.applyDataLayerZIndexesToDataLayerLayouts(),this.layout.data_layers.forEach((function(t,n){e.data_layers[t.id].layout_idx=n})),this}},{key:"clearSelections",value:function(){var t=this;return this.data_layer_ids_by_z_index.forEach((function(e){t.data_layers[e].setAllElementStatus("selected",!1)})),this}},{key:"render",value:function(){var t=this;this.svg.container.attr("transform","translate(".concat(this.layout.origin.x,", ").concat(this.layout.origin.y,")")),this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.inner_border.attr("x",this.layout.margin.left).attr("y",this.layout.margin.top).attr("width",this.layout.width-(this.layout.margin.left+this.layout.margin.right)).attr("height",this.layout.height-(this.layout.margin.top+this.layout.margin.bottom)),this.layout.inner_border&&this.inner_border.style("stroke-width",1).style("stroke",this.layout.inner_border),this.setTitle(),this.generateExtents();var e=function(t,e){var n=Math.pow(-10,e),a=Math.pow(-10,-e),r=Math.pow(10,-e),i=Math.pow(10,e);return t===1/0&&(t=i),t===-1/0&&(t=n),0===t&&(t=r),t>0&&(t=Math.max(Math.min(t,i),r)),t<0&&(t=Math.max(Math.min(t,a),n)),t},n={};if(this.x_extent){var a={start:0,end:this.layout.cliparea.width};this.layout.axes.x.range&&(a.start=this.layout.axes.x.range.start||a.start,a.end=this.layout.axes.x.range.end||a.end),n.x=[a.start,a.end],n.x_shifted=[a.start,a.end]}if(this.y1_extent){var r={start:this.layout.cliparea.height,end:0};this.layout.axes.y1.range&&(r.start=this.layout.axes.y1.range.start||r.start,r.end=this.layout.axes.y1.range.end||r.end),n.y1=[r.start,r.end],n.y1_shifted=[r.start,r.end]}if(this.y2_extent){var i={start:this.layout.cliparea.height,end:0};this.layout.axes.y2.range&&(i.start=this.layout.axes.y2.range.start||i.start,i.end=this.layout.axes.y2.range.end||i.end),n.y2=[i.start,i.end],n.y2_shifted=[i.start,i.end]}if(this.parent.interaction.panel_id&&(this.parent.interaction.panel_id===this.id||this.parent.interaction.linked_panel_ids.includes(this.id))){var o,s=null;if(this.parent.interaction.zooming&&"function"==typeof this.x_scale){var l=Math.abs(this.x_extent[1]-this.x_extent[0]),c=Math.round(this.x_scale.invert(n.x_shifted[1]))-Math.round(this.x_scale.invert(n.x_shifted[0])),u=this.parent.interaction.zooming.scale,h=Math.floor(c*(1/u));u<1&&!isNaN(this.parent.layout.max_region_scale)?u=1/(Math.min(h,this.parent.layout.max_region_scale)/c):u>1&&!isNaN(this.parent.layout.min_region_scale)&&(u=1/(Math.max(h,this.parent.layout.min_region_scale)/c));var d=Math.floor(l*u),p=(o=this.parent.interaction.zooming.center-this.layout.margin.left-this.layout.origin.x)/this.layout.cliparea.width,f=Math.max(Math.floor(this.x_scale.invert(n.x_shifted[0])-(d-c)*p),1);n.x_shifted=[this.x_scale(f),this.x_scale(f+d)]}else if(this.parent.interaction.dragging)switch(this.parent.interaction.dragging.method){case"background":n.x_shifted[0]=+this.parent.interaction.dragging.dragged_x,n.x_shifted[1]=this.layout.cliparea.width+this.parent.interaction.dragging.dragged_x;break;case"x_tick":A.event&&A.event.shiftKey?(n.x_shifted[0]=+this.parent.interaction.dragging.dragged_x,n.x_shifted[1]=this.layout.cliparea.width+this.parent.interaction.dragging.dragged_x):(s=e((o=this.parent.interaction.dragging.start_x-this.layout.margin.left-this.layout.origin.x)/(o+this.parent.interaction.dragging.dragged_x),3),n.x_shifted[0]=0,n.x_shifted[1]=Math.max(this.layout.cliparea.width*(1/s),1));break;case"y1_tick":case"y2_tick":var y="y".concat(this.parent.interaction.dragging.method[1],"_shifted");A.event&&A.event.shiftKey?(n[y][0]=this.layout.cliparea.height+this.parent.interaction.dragging.dragged_y,n[y][1]=+this.parent.interaction.dragging.dragged_y):(s=e((o=this.layout.cliparea.height-(this.parent.interaction.dragging.start_y-this.layout.margin.top-this.layout.origin.y))/(o-this.parent.interaction.dragging.dragged_y),3),n[y][0]=this.layout.cliparea.height,n[y][1]=this.layout.cliparea.height-this.layout.cliparea.height*(1/s))}}if(["x","y1","y2"].forEach((function(e){t["".concat(e,"_extent")]&&(t["".concat(e,"_scale")]=A.scaleLinear().domain(t["".concat(e,"_extent")]).range(n["".concat(e,"_shifted")]),t["".concat(e,"_extent")]=[t["".concat(e,"_scale")].invert(n[e][0]),t["".concat(e,"_scale")].invert(n[e][1])],t["".concat(e,"_scale")]=A.scaleLinear().domain(t["".concat(e,"_extent")]).range(n[e]),t.renderAxis(e))})),this.layout.interaction.scroll_to_zoom){var _=function(){if(A.event.shiftKey||A.event.altKey){if(A.event.preventDefault(),t.parent._canInteract(t.id)){var e=A.mouse(t.svg.container.node()),n=Math.max(-1,Math.min(1,A.event.wheelDelta||-A.event.detail||-A.event.deltaY));0!==n&&(t.parent.interaction={panel_id:t.id,linked_panel_ids:t.getLinkedPanelIds("x"),zooming:{scale:n<1?.9:1.1,center:e[0]}},t.render(),t.parent.interaction.linked_panel_ids.forEach((function(e){t.parent.panels[e].render()})),null!==t.zoom_timeout&&clearTimeout(t.zoom_timeout),t.zoom_timeout=setTimeout((function(){t.parent.interaction={},t.parent.applyState({start:t.x_extent[0],end:t.x_extent[1]})}),500))}}else t.parent._canInteract(t.id)&&t.loader.show("Press <tt>[SHIFT]</tt> or <tt>[ALT]</tt> while scrolling to zoom").hide(1e3)};this.svg.container.on("wheel.zoom",_).on("mousewheel.zoom",_).on("DOMMouseScroll.zoom",_)}return this.data_layer_ids_by_z_index.forEach((function(e){t.data_layers[e].draw().render()})),this}},{key:"addBasicLoader",value:function(t){var e=this;return void 0!==t&&(t=!0),t&&this.loader.show("Loading...").animate(),this.on("data_requested",(function(){e.loader.show("Loading...").animate()})),this.on("data_rendered",(function(){e.loader.hide()})),this}},{key:"applyDataLayerZIndexesToDataLayerLayouts",value:function(){var t=this;this.data_layer_ids_by_z_index.forEach((function(e,n){t.data_layers[e].layout.z_index=n}))}},{key:"getBaseId",value:function(){return"".concat(this.parent.id,".").concat(this.id)}},{key:"_getPageOrigin",value:function(){var t=this.parent._getPageOrigin();return{x:t.x+this.layout.origin.x,y:t.y+this.layout.origin.y}}},{key:"initializeLayout",value:function(){var t=this;if(0===this.layout.width&&null===this.layout.proportional_width&&(this.layout.proportional_width=1),0===this.layout.height&&null===this.layout.proportional_height){var e=Object.keys(this.parent.panels).length;this.layout.proportional_height=e>0?1/e:1}return this.setDimensions(),this.setOrigin(),this.setMargin(),this.x_range=[0,this.layout.cliparea.width],this.y1_range=[this.layout.cliparea.height,0],this.y2_range=[this.layout.cliparea.height,0],["x","y1","y2"].forEach((function(e){Object.keys(t.layout.axes[e]).length&&!1!==t.layout.axes[e].render?(t.layout.axes[e].render=!0,t.layout.axes[e].label=t.layout.axes[e].label||null):t.layout.axes[e].render=!1})),this.layout.data_layers.forEach((function(e){t.addDataLayer(e)})),this}},{key:"setDimensions",value:function(t,e){return void 0!==t&&void 0!==e?!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height)):(null!==this.layout.proportional_width&&(this.layout.width=Math.max(this.layout.proportional_width*this.parent.layout.width,this.layout.min_width)),null!==this.layout.proportional_height&&(this.layout.height=Math.max(this.layout.proportional_height*this.parent.layout.height,this.layout.min_height))),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.svg.clipRect&&this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.initialized&&(this.render(),this.curtain.update(),this.loader.update(),this.toolbar.update(),this.legend&&this.legend.position()),this}},{key:"setOrigin",value:function(t,e){return!isNaN(t)&&t>=0&&(this.layout.origin.x=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.origin.y=Math.max(Math.round(+e),0)),this.initialized&&this.render(),this}},{key:"setMargin",value:function(t,e,n,a){var r,i=this;return!isNaN(t)&&t>=0&&(this.layout.margin.top=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.margin.right=Math.max(Math.round(+e),0)),!isNaN(n)&&n>=0&&(this.layout.margin.bottom=Math.max(Math.round(+n),0)),!isNaN(a)&&a>=0&&(this.layout.margin.left=Math.max(Math.round(+a),0)),this.layout.margin.top+this.layout.margin.bottom>this.layout.height&&(r=Math.floor((this.layout.margin.top+this.layout.margin.bottom-this.layout.height)/2),this.layout.margin.top-=r,this.layout.margin.bottom-=r),this.layout.margin.left+this.layout.margin.right>this.layout.width&&(r=Math.floor((this.layout.margin.left+this.layout.margin.right-this.layout.width)/2),this.layout.margin.left-=r,this.layout.margin.right-=r),["top","right","bottom","left"].forEach((function(t){i.layout.margin[t]=Math.max(i.layout.margin[t],0)})),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.layout.cliparea.origin.x=this.layout.margin.left,this.layout.cliparea.origin.y=this.layout.margin.top,this.initialized&&this.render(),this}},{key:"initialize",value:function(){var t=this,e=this.getBaseId();this.svg.container=this.parent.svg.append("g").attr("id","".concat(e,".panel_container")).attr("transform","translate(".concat(this.layout.origin.x||0,", ").concat(this.layout.origin.y||0,")"));var n=this.svg.container.append("clipPath").attr("id","".concat(e,".clip"));if(this.svg.clipRect=n.append("rect").attr("width",this.layout.width).attr("height",this.layout.height),this.svg.group=this.svg.container.append("g").attr("id","".concat(e,".panel")).attr("clip-path","url(#".concat(e,".clip)")),this.curtain=ut.call(this),this.loader=ht.call(this),this.toolbar=new te(this),this.inner_border=this.svg.group.append("rect").attr("class","lz-panel-background").on("click",(function(){"clear_selections"===t.layout.background_click&&t.clearSelections()})),this.title=this.svg.group.append("text").attr("class","lz-panel-title"),void 0!==this.layout.title&&this.setTitle(),this.svg.x_axis=this.svg.group.append("g").attr("id","".concat(e,".x_axis")).attr("class","lz-x lz-axis"),this.layout.axes.x.render&&(this.svg.x_axis_label=this.svg.x_axis.append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle")),this.svg.y1_axis=this.svg.group.append("g").attr("id","".concat(e,".y1_axis")).attr("class","lz-y lz-y1 lz-axis"),this.layout.axes.y1.render&&(this.svg.y1_axis_label=this.svg.y1_axis.append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle")),this.svg.y2_axis=this.svg.group.append("g").attr("id","".concat(e,".y2_axis")).attr("class","lz-y lz-y2 lz-axis"),this.layout.axes.y2.render&&(this.svg.y2_axis_label=this.svg.y2_axis.append("text").attr("class","lz-y2 lz-axis lz-label").attr("text-anchor","middle")),this.data_layer_ids_by_z_index.forEach((function(e){t.data_layers[e].initialize()})),this.legend=null,this.layout.legend&&(this.legend=new ae(this)),this.layout.interaction.drag_background_to_pan){var a=".".concat(this.parent.id,".").concat(this.id,".interaction.drag"),r=function(){return t.parent.startDrag(t,"background")};this.svg.container.select(".lz-panel-background").on("mousedown".concat(a,".background"),r).on("touchstart".concat(a,".background"),r)}return this}},{key:"resortDataLayers",value:function(){var t=this,e=[];this.data_layer_ids_by_z_index.forEach((function(n){e.push(t.data_layers[n].layout.z_index)})),this.svg.group.selectAll("g.lz-data_layer-container").data(e).sort(A.ascending),this.applyDataLayerZIndexesToDataLayerLayouts()}},{key:"getLinkedPanelIds",value:function(t){var e=this,n=[];return["x","y1","y2"].includes(t=t||null)&&this.layout.interaction["".concat(t,"_linked")]?(this.parent.panel_ids_by_y_index.forEach((function(a){a!==e.id&&e.parent.panels[a].layout.interaction["".concat(t,"_linked")]&&n.push(a)})),n):n}},{key:"moveUp",value:function(){return this.parent.panel_ids_by_y_index[this.layout.y_index-1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index-1],this.parent.panel_ids_by_y_index[this.layout.y_index-1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this}},{key:"moveDown",value:function(){return this.parent.panel_ids_by_y_index[this.layout.y_index+1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index+1],this.parent.panel_ids_by_y_index[this.layout.y_index+1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this}},{key:"reMap",value:function(){var t=this;for(var e in this.emit("data_requested"),this.data_promises=[],this.curtain.hide(),this.data_layers)try{this.data_promises.push(this.data_layers[e].reMap())}catch(t){console.error(t),this.curtain.show(t.message||t)}return Promise.all(this.data_promises).then((function(){t.initialized=!0,t.render(),t.emit("layout_changed",!0),t.emit("data_rendered")})).catch((function(e){console.error(e),t.curtain.show(e.message||e)}))}},{key:"generateExtents",value:function(){var t=this;for(var e in["x","y1","y2"].forEach((function(e){t["".concat(e,"_extent")]=null})),this.data_layers){var n=this.data_layers[e];if(n.layout.x_axis&&!n.layout.x_axis.decoupled&&(this.x_extent=A.extent((this.x_extent||[]).concat(n.getAxisExtent("x")))),n.layout.y_axis&&!n.layout.y_axis.decoupled){var a="y".concat(n.layout.y_axis.axis);this["".concat(a,"_extent")]=A.extent((this["".concat(a,"_extent")]||[]).concat(n.getAxisExtent("y")))}}return this.layout.axes.x&&"state"===this.layout.axes.x.extent&&(this.x_extent=[this.state.start,this.state.end]),this}},{key:"generateTicks",value:function(t){if(this.layout.axes[t].ticks){var e=this.layout.axes[t].ticks;if(Array.isArray(e))return e;if("object"===re(e)){var n=this,a={position:e.position};return this.data_layer_ids_by_z_index.reduce((function(e,r){var i=n.data_layers[r];return e.concat(i.getTicks(t,a))}),[]).map((function(t){var n={};return n=Object(rt.c)(n,e),Object(rt.c)(n,t)}))}}return this["".concat(t,"_extent")]?function(t,e,n){(void 0===n||isNaN(parseInt(n)))&&(n=5);var a=(n=+n)/3,r=Math.abs(t[0]-t[1]),i=r/n;Math.log(r)/Math.LN10<-2&&(i=.75*Math.max(Math.abs(r))/a);var o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=0;o<1&&0!==o&&(s=Math.abs(Math.round(Math.log(o)/Math.LN10)));var l=o;2*o-i<1.5*(i-l)&&5*o-i<2.75*(i-(l=2*o))&&10*o-i<1.5*(i-(l=5*o))&&(l=10*o);for(var c=[],u=parseFloat((Math.floor(t[0]/l)*l).toFixed(s));u<t[1];)c.push(u),u+=l,s>0&&(u=parseFloat(u.toFixed(s)));return c.push(u),(void 0===e||-1===["low","high","both","neither"].indexOf(e))&&(e="neither"),"low"!==e&&"both"!==e||c[0]<t[0]&&(c=c.slice(1)),"high"!==e&&"both"!==e||c[c.length-1]>t[1]&&c.pop(),c}(this["".concat(t,"_extent")],"both"):[]}},{key:"renderAxis",value:function(t){var e=this;if(!["x","y1","y2"].includes(t))throw new Error("Unable to render axis; invalid axis identifier: ".concat(t));var n=this.layout.axes[t].render&&"function"==typeof this["".concat(t,"_scale")]&&!isNaN(this["".concat(t,"_scale")](0));if(this["".concat(t,"_axis")]&&this.svg.container.select("g.lz-axis.lz-".concat(t)).style("display",n?null:"none"),!n)return this;var a={x:{position:"translate(".concat(this.layout.margin.left,", ").concat(this.layout.height-this.layout.margin.bottom,")"),orientation:"bottom",label_x:this.layout.cliparea.width/2,label_y:this.layout.axes[t].label_offset||0,label_rotate:null},y1:{position:"translate(".concat(this.layout.margin.left,", ").concat(this.layout.margin.top,")"),orientation:"left",label_x:-1*(this.layout.axes[t].label_offset||0),label_y:this.layout.cliparea.height/2,label_rotate:-90},y2:{position:"translate(".concat(this.layout.width-this.layout.margin.right,", ").concat(this.layout.margin.top,")"),orientation:"right",label_x:this.layout.axes[t].label_offset||0,label_y:this.layout.cliparea.height/2,label_rotate:-90}};this["".concat(t,"_ticks")]=this.generateTicks(t);var r,i=function(t){for(var e=0;e<t.length;e++)if(isNaN(t[e]))return!1;return!0}(this["".concat(t,"_ticks")]);switch(a[t].orientation){case"right":r=A.axisRight;break;case"left":r=A.axisLeft;break;case"bottom":r=A.axisBottom;break;default:throw new Error("Unrecognized axis orientation")}if(this["".concat(t,"_axis")]=r(this["".concat(t,"_scale")]).tickPadding(3),i)this["".concat(t,"_axis")].tickValues(this["".concat(t,"_ticks")]),"region"===this.layout.axes[t].tick_format&&this["".concat(t,"_axis")].tickFormat((function(t){return ge(t,6)}));else{var o=this["".concat(t,"_ticks")].map((function(e){return e[t.substr(0,1)]}));this["".concat(t,"_axis")].tickValues(o).tickFormat((function(n,a){return e["".concat(t,"_ticks")][a].text}))}if(this.svg["".concat(t,"_axis")].attr("transform",a[t].position).call(this["".concat(t,"_axis")]),!i){var s=A.selectAll("g#".concat(this.getBaseId().replace(".","\\."),"\\.").concat(t,"_axis g.tick")),l=this;s.each((function(e,n){var a=A.select(this).select("text");l["".concat(t,"_ticks")][n].style&&dt(a,l["".concat(t,"_ticks")][n].style),l["".concat(t,"_ticks")][n].transform&&a.attr("transform",l["".concat(t,"_ticks")][n].transform)}))}var c=this.layout.axes[t].label||null;return null!==c&&(this.svg["".concat(t,"_axis_label")].attr("x",a[t].label_x).attr("y",a[t].label_y).text(ve(this.state,c)).attr("fill","currentColor"),null!==a[t].label_rotate&&this.svg["".concat(t,"_axis_label")].attr("transform","rotate(".concat(a[t].label_rotate," ").concat(a[t].label_x,", ").concat(a[t].label_y,")"))),["x","y1","y2"].forEach((function(t){if(e.layout.interaction["drag_".concat(t,"_ticks_to_scale")]){var n=".".concat(e.parent.id,".").concat(e.id,".interaction.drag");e.svg.container.selectAll(".lz-axis.lz-".concat(t," .tick text")).attr("tabindex",0).on("mouseover".concat(n),(function e(){"function"==typeof A.select(this).node().focus&&A.select(this).node().focus();var a="x"===t?"ew-resize":"ns-resize";A.event&&A.event.shiftKey&&(a="move"),A.select(this).style("font-weight","bold").style("cursor",a).on("keydown".concat(n),e).on("keyup".concat(n),e)})).on("mouseout".concat(n),(function(){A.select(this).style("font-weight","normal").on("keydown".concat(n),null).on("keyup".concat(n),null)})).on("mousedown".concat(n),(function(){e.parent.startDrag(e,"".concat(t,"_tick"))}))}})),this}},{key:"scaleHeightToData",value:function(t){var e=this;null===(t=+t||null)&&this.data_layer_ids_by_z_index.forEach((function(n){var a=e.data_layers[n].getAbsoluteDataHeight();+a&&(t=null===t?+a:Math.max(t,+a))})),+t&&(t+=+this.layout.margin.top+ +this.layout.margin.bottom,this.setDimensions(this.layout.width,t),this.parent.setDimensions(),this.parent.panel_ids_by_y_index.forEach((function(t){e.parent.panels[t].layout.proportional_height=null})),this.parent.positionPanels())}},{key:"setAllElementStatus",value:function(t,e){var n=this;this.data_layer_ids_by_z_index.forEach((function(a){n.data_layers[a].setAllElementStatus(t,e)}))}}])&&ie(e.prototype,n),a&&ie(e,a),t}();function le(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||ue(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=ue(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ue(t,e){if(t){if("string"==typeof t)return he(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(t,e):void 0}}function he(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function de(t){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}R.verbs.forEach((function(t,e){var n=R.adjectives[e],a="un".concat(t);se.prototype["".concat(t,"AllElements")]=function(){return this.setAllElementStatus(n,!0),this},se.prototype["".concat(a,"AllElements")]=function(){return this.setAllElementStatus(n,!1),this}}));var fe={state:{},width:1,height:1,min_width:1,min_height:1,responsive_resize:!1,panels:[],toolbar:{widgets:[]},panel_boundaries:!0,mouse_guide:!0};var ye=function(){function t(e,n,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initialized=!1,this.parent_plot=this,this.id=e,this.container=null,this.svg=null,this.panels={},this.panel_ids_by_y_index=[],this.remap_promises=[],this.layout=a,Object(rt.c)(this.layout,fe),this._base_layout=Object(rt.b)(this.layout),this.state=this.layout.state,this.lzd=new ot(n),this._external_listeners=new Map,this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[],element_selection:[],match_requested:[],panel_removed:[],region_changed:[],state_changed:[]},this.interaction={},this.initializeLayout()}var e,n,a;return e=t,(n=[{key:"on",value:function(t,e){if(!Array.isArray(this.event_hooks[t]))throw new Error("Unable to register event hook, invalid event: ".concat(t.toString()));if("function"!=typeof e)throw new Error("Unable to register event hook, invalid hook function passed");return this.event_hooks[t].push(e),e}},{key:"off",value:function(t,e){var n=this.event_hooks[t];if(!Array.isArray(n))throw new Error("Unable to remove event hook, invalid event: ".concat(t.toString()));if(void 0===e)this.event_hooks[t]=[];else{var a=n.indexOf(e);if(-1===a)throw new Error("The specified event listener is not registered and therefore cannot be removed");n.splice(a,1)}return this}},{key:"emit",value:function(t,e){var n=this;if(!Array.isArray(this.event_hooks[t]))throw new Error("LocusZoom attempted to throw an invalid event: ".concat(t.toString()));var a=this.getBaseId();return this.event_hooks[t].forEach((function(t){var r;r=e&&e.sourceID?e:{sourceID:a,target:n,data:e||null},t.call(n,r)})),this}},{key:"addPanel",value:function(t){if("object"!==de(t))throw new Error("Invalid panel layout");var e=new se(t,this);if(this.panels[e.id]=e,null!==e.layout.y_index&&!isNaN(e.layout.y_index)&&this.panel_ids_by_y_index.length>0)e.layout.y_index<0&&(e.layout.y_index=Math.max(this.panel_ids_by_y_index.length+e.layout.y_index,0)),this.panel_ids_by_y_index.splice(e.layout.y_index,0,e.id),this.applyPanelYIndexesToPanelLayouts();else{var n=this.panel_ids_by_y_index.push(e.id);this.panels[e.id].layout.y_index=n-1}var a=null;return this.layout.panels.forEach((function(t,n){t.id===e.id&&(a=n)})),null===a&&(a=this.layout.panels.push(this.panels[e.id].layout)-1),this.panels[e.id].layout_idx=a,this.initialized&&(this.positionPanels(),this.panels[e.id].initialize(),this.panels[e.id].reMap(),this.setDimensions(this.layout.width,this.layout.height)),this.panels[e.id]}},{key:"clearPanelData",value:function(t,e){var n=this;return e=e||"wipe",(t?[t]:Object.keys(this.panels)).forEach((function(t){n.panels[t].data_layer_ids_by_z_index.forEach((function(a){var r=n.panels[t].data_layers[a];r.destroyAllTooltips(),delete r.layer_state,delete n.layout.state[r.state_id],"reset"===e&&r._setDefaultState()}))})),this}},{key:"removePanel",value:function(t){var e=this;if(!this.panels[t])throw new Error("Unable to remove panel, ID not found: ".concat(t));return this.panel_boundaries.hide(),this.clearPanelData(t),this.panels[t].loader.hide(),this.panels[t].toolbar.destroy(!0),this.panels[t].curtain.hide(),this.panels[t].svg.container&&this.panels[t].svg.container.remove(),this.layout.panels.splice(this.panels[t].layout_idx,1),delete this.panels[t],delete this.layout.state[t],this.layout.panels.forEach((function(t,n){e.panels[t.id].layout_idx=n})),this.panel_ids_by_y_index.splice(this.panel_ids_by_y_index.indexOf(t),1),this.applyPanelYIndexesToPanelLayouts(),this.initialized&&(this.layout.min_height=this._base_layout.min_height,this.layout.min_width=this._base_layout.min_width,this.positionPanels(),this.setDimensions(this.layout.width,this.layout.height)),this.emit("panel_removed",t),this}},{key:"refresh",value:function(){return this.applyState()}},{key:"subscribeToData",value:function(t,e,n){var a=this,r=(n=n||{}).onerror||function(t){console.log("An error occurred while acting on an external callback",t)},i=function(){try{a.lzd.getData(a.state,t).then((function(t){return e(n.discrete?t.discrete:t.body,a)})).catch(r)}catch(t){r(t)}};return this.on("data_rendered",i),i}},{key:"applyState",value:function(t){var e=this;if("object"!=de(t=t||{}))throw new Error("applyState only accepts an object; ".concat(de(t)," given"));var n={chr:this.state.chr,start:this.state.start,end:this.state.end};for(var a in t)n[a]=t[a];for(var r in n=function(t,e){e=e||{};var n,a=!1,r=null;if(void 0!==(t=t||{}).chr&&void 0!==t.start&&void 0!==t.end){if(t.start=Math.max(parseInt(t.start),1),t.end=Math.max(parseInt(t.end),1),isNaN(t.start)&&isNaN(t.end))t.start=1,t.end=1,r=.5,n=0;else if(isNaN(t.start)||isNaN(t.end))r=t.start||t.end,n=0,t.start=isNaN(t.start)?t.end:t.start,t.end=isNaN(t.end)?t.start:t.end;else{if(r=Math.round((t.start+t.end)/2),(n=t.end-t.start)<0){var i=t.start;t.end=t.start,t.start=i,n=t.end-t.start}r<0&&(t.start=1,t.end=1,n=0)}a=!0}return!isNaN(e.min_region_scale)&&a&&n<e.min_region_scale&&(t.start=Math.max(r-Math.floor(e.min_region_scale/2),1),t.end=t.start+e.min_region_scale),!isNaN(e.max_region_scale)&&a&&n>e.max_region_scale&&(t.start=Math.max(r-Math.floor(e.max_region_scale/2),1),t.end=t.start+e.max_region_scale),t}(n,this.layout))this.state[r]=n[r];for(var i in this.emit("data_requested"),this.remap_promises=[],this.loading_data=!0,this.panels)this.remap_promises.push(this.panels[i].reMap());return Promise.all(this.remap_promises).catch((function(t){console.error(t),e.curtain.show(t.message||t),e.loading_data=!1})).then((function(){e.toolbar.update(),e.panel_ids_by_y_index.forEach((function(t){var n=e.panels[t];n.toolbar.update(),n.data_layer_ids_by_z_index.forEach((function(t){n.data_layers[t].applyAllElementStatus()}))})),e.emit("layout_changed"),e.emit("data_rendered"),e.emit("state_changed",t);var n=e.state,a=n.chr,r=n.start,i=n.end;Object.keys(t).some((function(t){return["chr","start","end"].includes(t)}))&&e.emit("region_changed",{chr:a,start:r,end:i}),e.loading_data=!1}))}},{key:"trackExternalListener",value:function(t,e,n){this._external_listeners.has(t)||this._external_listeners.set(t,new Map);var a=this._external_listeners.get(t),r=a.get(e)||[];r.includes(n)||r.push(n),a.set(e,r)}},{key:"destroy",value:function(){var t,e=ce(this._external_listeners.entries());try{for(e.s();!(t=e.n()).done;){var n,a=le(t.value,2),r=a[0],i=ce(a[1]);try{for(i.s();!(n=i.n()).done;){var o,s=le(n.value,2),l=s[0],c=ce(s[1]);try{for(c.s();!(o=c.n()).done;){var u=o.value;r.removeEventListener(l,u)}}catch(t){c.e(t)}finally{c.f()}}}catch(t){i.e(t)}finally{i.f()}}}catch(t){e.e(t)}finally{e.f()}var h=this.svg.node().parentNode;if(!h)throw new Error("Plot has already been removed");for(;h.lastElementChild;)h.removeChild(h.lastElementChild);h.outerHTML=h.outerHTML,this.initialized=!1,this.svg=null,this.panels=null}},{key:"_canInteract",value:function(t){return(t=t||null)?(void 0===this.interaction.panel_id||this.interaction.panel_id===t)&&!this.loading_data:!(this.interaction.dragging||this.interaction.zooming||this.loading_data)}},{key:"_getPageOrigin",value:function(){for(var t=this.svg.node().getBoundingClientRect(),e=document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.scrollTop||document.body.scrollTop,a=this.svg.node();null!==a.parentNode;)if((a=a.parentNode)!==document&&"static"!==A.select(a).style("position")){e=-1*a.getBoundingClientRect().left,n=-1*a.getBoundingClientRect().top;break}return{x:e+t.left,y:n+t.top,width:t.width,height:t.height}}},{key:"getContainerOffset",value:function(){for(var t={top:0,left:0},e=this.container.offsetParent||null;null!==e;)t.top+=e.offsetTop,t.left+=e.offsetLeft,e=e.offsetParent||null;return t}},{key:"applyPanelYIndexesToPanelLayouts",value:function(){var t=this;this.panel_ids_by_y_index.forEach((function(e,n){t.panels[e].layout.y_index=n}))}},{key:"getBaseId",value:function(){return this.id}},{key:"sumProportional",value:function(t){if("height"!==t&&"width"!==t)throw new Error("Bad dimension value passed to sumProportional");var e=0;for(var n in this.panels)this.panels[n].layout["proportional_".concat(t)]||(this.panels[n].layout["proportional_".concat(t)]=1/Object.keys(this.panels).length),e+=this.panels[n].layout["proportional_".concat(t)];return e}},{key:"rescaleSVG",value:function(){var t=this.svg.node().getBoundingClientRect();return this.setDimensions(t.width,t.height),this}},{key:"initializeLayout",value:function(){var t=this;if(isNaN(this.layout.width)||this.layout.width<=0)throw new Error("Plot layout parameter `width` must be a positive number");if(isNaN(this.layout.height)||this.layout.height<=0)throw new Error("Plot layout parameter `width` must be a positive number");if(this.layout.responsive_resize=!!this.layout.responsive_resize,this.layout.responsive_resize){var e=function(){return t.rescaleSVG()};window.addEventListener("resize",e),this.trackExternalListener(window,"resize",e);var n=function(){return t.setDimensions()};window.addEventListener("load",n),this.trackExternalListener(window,"load",n)}return this.layout.panels.forEach((function(e){t.addPanel(e)})),this}},{key:"setDimensions",value:function(t,e){var n,a=this,r=parseFloat(this.layout.min_width)||0,i=parseFloat(this.layout.min_height)||0;for(n in this.panels)r=Math.max(r,this.panels[n].layout.min_width),parseFloat(this.panels[n].layout.min_height)>0&&parseFloat(this.panels[n].layout.proportional_height)>0&&(i=Math.max(i,this.panels[n].layout.min_height/this.panels[n].layout.proportional_height));if(this.layout.min_width=Math.max(r,1),this.layout.min_height=Math.max(i,1),A.select(this.svg.node().parentNode).style("min-width","".concat(this.layout.min_width,"px")).style("min-height","".concat(this.layout.min_height,"px")),!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0){this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height),this.layout.responsive_resize&&this.svg&&(this.layout.width=Math.max(this.svg.node().parentNode.getBoundingClientRect().width,this.layout.min_width));var o=0;this.panel_ids_by_y_index.forEach((function(t){var e=a.layout.width,n=a.panels[t].layout.proportional_height*a.layout.height;a.panels[t].setDimensions(e,n),a.panels[t].setOrigin(0,o),a.panels[t].layout.proportional_origin.x=0,a.panels[t].layout.proportional_origin.y=o/a.layout.height,o+=n,a.panels[t].toolbar.update()}))}else if(Object.keys(this.panels).length){for(n in this.layout.width=0,this.layout.height=0,this.panels)this.layout.width=Math.max(this.panels[n].layout.width,this.layout.width),this.layout.height+=this.panels[n].layout.height;this.layout.width=Math.max(this.layout.width,this.layout.min_width),this.layout.height=Math.max(this.layout.height,this.layout.min_height)}return null!==this.svg&&(this.svg.attr("viewBox","0 0 ".concat(this.layout.width," ").concat(this.layout.height)),this.svg.attr("width",this.layout.width).attr("height",this.layout.height)),this.initialized&&(this.panel_boundaries.position(),this.toolbar.update(),this.curtain.update(),this.loader.update()),this.emit("layout_changed")}},{key:"positionPanels",value:function(){var t,e=this,n={left:0,right:0};for(t in this.panels)null===this.panels[t].layout.proportional_height&&(this.panels[t].layout.proportional_height=this.panels[t].layout.height/this.layout.height),null===this.panels[t].layout.proportional_width&&(this.panels[t].layout.proportional_width=1),this.panels[t].layout.interaction.x_linked&&(n.left=Math.max(n.left,this.panels[t].layout.margin.left),n.right=Math.max(n.right,this.panels[t].layout.margin.right));var a=this.sumProportional("height");if(!a)return this;var r=1/a;for(t in this.panels)this.panels[t].layout.proportional_height*=r;var i=0;this.panel_ids_by_y_index.forEach((function(t){if(e.panels[t].setOrigin(0,i),e.panels[t].layout.proportional_origin.x=0,i+=e.panels[t].layout.height,e.panels[t].layout.interaction.x_linked){var a=Math.max(n.left-e.panels[t].layout.margin.left,0)+Math.max(n.right-e.panels[t].layout.margin.right,0);e.panels[t].layout.width+=a,e.panels[t].layout.margin.left=n.left,e.panels[t].layout.margin.right=n.right,e.panels[t].layout.cliparea.origin.x=n.left}}));var o=i;return this.panel_ids_by_y_index.forEach((function(t){e.panels[t].layout.proportional_origin.y=e.panels[t].layout.origin.y/o})),this.setDimensions(),this.panel_ids_by_y_index.forEach((function(t){e.panels[t].setDimensions(e.layout.width*e.panels[t].layout.proportional_width,e.layout.height*e.panels[t].layout.proportional_height)})),this}},{key:"initialize",value:function(){var t=this;if(this.layout.responsive_resize&&A.select(this.container).classed("lz-container-responsive",!0),this.layout.mouse_guide){var e=this.svg.append("g").attr("class","lz-mouse_guide").attr("id","".concat(this.id,".mouse_guide")),n=e.append("rect").attr("class","lz-mouse_guide-vertical").attr("x",-1),a=e.append("rect").attr("class","lz-mouse_guide-horizontal").attr("y",-1);this.mouse_guide={svg:e,vertical:n,horizontal:a}}for(var r in this.curtain=ut.call(this),this.loader=ht.call(this),this.panel_boundaries={parent:this,hide_timeout:null,showing:!1,dragging:!1,selectors:[],corner_selector:null,show:function(){var t=this;if(!this.showing&&!this.parent.curtain.showing){this.showing=!0,this.parent.panel_ids_by_y_index.forEach((function(e,n){var a=A.select(t.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-boundary").attr("title","Resize panel");a.append("span");var r=A.drag();r.on("start",(function(){t.dragging=!0})),r.on("end",(function(){t.dragging=!1})),r.on("drag",(function(){var e=t.parent.panels[t.parent.panel_ids_by_y_index[n]],a=e.layout.height;e.setDimensions(e.layout.width,e.layout.height+A.event.dy);var r=e.layout.height-a,i=t.parent.layout.height+r;t.parent.panel_ids_by_y_index.forEach((function(e,a){var o=t.parent.panels[t.parent.panel_ids_by_y_index[a]];o.layout.proportional_height=o.layout.height/i,a>n&&(o.setOrigin(o.layout.origin.x,o.layout.origin.y+r),o.toolbar.position())})),t.parent.positionPanels(),t.position()})),a.call(r),t.parent.panel_boundaries.selectors.push(a)}));var e=A.select(this.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-corner-boundary").attr("title","Resize plot");e.append("span").attr("class","lz-panel-corner-boundary-outer"),e.append("span").attr("class","lz-panel-corner-boundary-inner");var n=A.drag();n.on("start",(function(){t.dragging=!0})),n.on("end",(function(){t.dragging=!1})),n.on("drag",(function(){t.parent.setDimensions(t.parent.layout.width+A.event.dx,t.parent.layout.height+A.event.dy)})),e.call(n),this.parent.panel_boundaries.corner_selector=e}return this.position()},position:function(){var t=this;if(!this.showing)return this;var e=this.parent._getPageOrigin();return this.selectors.forEach((function(n,a){var r=t.parent.panels[t.parent.panel_ids_by_y_index[a]]._getPageOrigin(),i=e.x,o=r.y+t.parent.panels[t.parent.panel_ids_by_y_index[a]].layout.height-12,s=t.parent.layout.width-1;n.style("top","".concat(o,"px")).style("left","".concat(i,"px")).style("width","".concat(s,"px")),n.select("span").style("width","".concat(s,"px"))})),this.corner_selector.style("top","".concat(e.y+this.parent.layout.height-10-16,"px")).style("left","".concat(e.x+this.parent.layout.width-10-16,"px")),this},hide:function(){return this.showing?(this.showing=!1,this.selectors.forEach((function(t){t.remove()})),this.selectors=[],this.corner_selector.remove(),this.corner_selector=null,this):this}},this.layout.panel_boundaries&&A.select(this.svg.node().parentNode).on("mouseover.".concat(this.id,".panel_boundaries"),(function(){clearTimeout(t.panel_boundaries.hide_timeout),t.panel_boundaries.show()})).on("mouseout.".concat(this.id,".panel_boundaries"),(function(){t.panel_boundaries.hide_timeout=setTimeout((function(){t.panel_boundaries.hide()}),300)})),this.toolbar=new te(this).show(),this.panels)this.panels[r].initialize();var i=".".concat(this.id);if(this.layout.mouse_guide){var o=function(){t.mouse_guide.vertical.attr("x",-1),t.mouse_guide.horizontal.attr("y",-1)};this.svg.on("mouseout".concat(i,"-mouse_guide"),o).on("touchleave".concat(i,"-mouse_guide"),o).on("mousemove".concat(i,"-mouse_guide"),(function(){var e=A.mouse(t.svg.node());t.mouse_guide.vertical.attr("x",e[0]),t.mouse_guide.horizontal.attr("y",e[1])}))}var s=function(){t.stopDrag()},l=function(){if(t.interaction.dragging){var e=A.mouse(t.svg.node());A.event&&A.event.preventDefault(),t.interaction.dragging.dragged_x=e[0]-t.interaction.dragging.start_x,t.interaction.dragging.dragged_y=e[1]-t.interaction.dragging.start_y,t.panels[t.interaction.panel_id].render(),t.interaction.linked_panel_ids.forEach((function(e){t.panels[e].render()}))}};this.svg.on("mouseup".concat(i),s).on("touchend".concat(i),s).on("mousemove".concat(i),l).on("touchmove".concat(i),l);var c=A.select("body").node();c&&(c.addEventListener("mouseup",s),c.addEventListener("touchend",s),this.trackExternalListener(c,"mouseup",s),this.trackExternalListener(c,"touchend",s)),this.on("match_requested",(function(e){var n=e.data,a=n.active?n.value:null;t.applyState({lz_match_value:a})})),this.initialized=!0;var u=this.svg.node().getBoundingClientRect(),h=u.width?u.width:this.layout.width,d=u.height?u.height:this.layout.height;return this.setDimensions(h,d),this}},{key:"startDrag",value:function(t,e){t=t||null;var n=null;switch(e=e||null){case"background":case"x_tick":n="x";break;case"y1_tick":n="y1";break;case"y2_tick":n="y2"}if(!(t instanceof se&&n&&this._canInteract()))return this.stopDrag();var a=A.mouse(this.svg.node());return this.interaction={panel_id:t.id,linked_panel_ids:t.getLinkedPanelIds(n),dragging:{method:e,start_x:a[0],start_y:a[1],dragged_x:0,dragged_y:0,axis:n}},this.svg.style("cursor","all-scroll"),this}},{key:"stopDrag",value:function(){if(!this.interaction.dragging)return this;if("object"!=de(this.panels[this.interaction.panel_id]))return this.interaction={},this;var t=this.panels[this.interaction.panel_id],e=function(e,n,a){t.data_layer_ids_by_z_index.forEach((function(r){var i=t.data_layers[r].layout["".concat(e,"_axis")];i.axis===n&&(i.floor=a[0],i.ceiling=a[1],delete i.lower_buffer,delete i.upper_buffer,delete i.min_extent,delete i.ticks)}))};switch(this.interaction.dragging.method){case"background":case"x_tick":0!==this.interaction.dragging.dragged_x&&(e("x",1,t.x_extent),this.applyState({start:t.x_extent[0],end:t.x_extent[1]}));break;case"y1_tick":case"y2_tick":if(0!==this.interaction.dragging.dragged_y){var n=parseInt(this.interaction.dragging.method[1]);e("y",n,t["y".concat(n,"_extent")])}}return this.interaction={},this.svg.style("cursor",null),this}}])&&pe(e.prototype,n),a&&pe(e,a),t}();function _e(t){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ge(t,e,n){var a={0:"",3:"K",6:"M",9:"G"};if(n=n||!1,isNaN(e)||null===e){var r=Math.log(t)/Math.LN10;e=Math.min(Math.max(r-r%3,0),9)}var i=e-Math.floor((Math.log(t)/Math.LN10).toFixed(e+3)),o=Math.min(Math.max(e,0),2),s=Math.min(Math.max(i,o),12),l="".concat((t/Math.pow(10,e)).toFixed(s));return n&&void 0!==a[e]&&(l+=" ".concat(a[e],"b")),l}function me(t){var e=t.toUpperCase();e=e.replace(/,/g,"");var n=/([KMG])[B]*$/,a=n.exec(e),r=1;return a&&(r="M"===a[1]?1e6:"G"===a[1]?1e9:1e3,e=e.replace(n,"")),e=Number(e)*r}function ve(t,e){if("object"!=_e(t))throw new Error("invalid arguments: data is not an object");if("string"!=typeof e)throw new Error("invalid arguments: html is not a string");for(var n=[],a=/{{(?:(#if )?([A-Za-z0-9_:|]+)|(\/if))}}/;e.length>0;){var r=a.exec(e);r?0!==r.index?(n.push({text:e.slice(0,r.index)}),e=e.slice(r.index)):"#if "===r[1]?(n.push({condition:r[2]}),e=e.slice(r[0].length)):r[2]?(n.push({variable:r[2]}),e=e.slice(r[0].length)):"/if"===r[3]?(n.push({close:"if"}),e=e.slice(r[0].length)):(console.error("Error tokenizing tooltip when remaining template is ".concat(JSON.stringify(e)," and previous tokens are ").concat(JSON.stringify(n)," and current regex match is ").concat(JSON.stringify([r[1],r[2],r[3]]))),e=e.slice(r[0].length)):(n.push({text:e}),e="")}for(var i=function t(){var e=n.shift();if(void 0!==e.text||e.variable)return e;if(e.condition){for(e.then=[];n.length>0;){if("if"===n[0].close){n.shift();break}e.then.push(t())}return e}return console.error("Error making tooltip AST due to unknown token ".concat(JSON.stringify(e))),{text:""}},o=[];n.length>0;)o.push(i());var s=function e(n){return Object.prototype.hasOwnProperty.call(e.cache,n)||(e.cache[n]=new at(n).resolve(t)),e.cache[n]};s.cache={};return o.map((function t(e){if(void 0!==e.text)return e.text;if(e.variable){try{var n=s(e.variable);if(-1!==["string","number","boolean"].indexOf(_e(n)))return n;if(null===n)return""}catch(t){console.error("Error while processing variable ".concat(JSON.stringify(e.variable)))}return"{{".concat(e.variable,"}}")}if(e.condition){try{var a=s(e.condition);if(a||0===a)return e.then.map(t).join("")}catch(t){console.error("Error while processing condition ".concat(JSON.stringify(e.variable)))}return""}console.error("Error rendering tooltip due to unknown AST node ".concat(JSON.stringify(e)))})).join("")}var be=function(t,e){return void 0===e||t.field_value!==e?void 0!==t.else?t.else:null:t.then},xe=function(t,e){var n=t.breaks||[],a=t.values||[];if(null==e||isNaN(+e))return t.null_value?t.null_value:null;var r=n.reduce((function(t,n){return+e<t||+e>=t&&+e<n?t:n}));return a[n.indexOf(r)]},we=function(t,e){return void 0!==e&&t.categories.includes(e)?t.values[t.categories.indexOf(e)]:t.null_value?t.null_value:null},ke=function(t,e,n){var a=t.values;return a[n%a.length]},Se=function(t,e){var n=t.breaks||[],a=t.values||[],r=t.null_value?t.null_value:null;if(n.length<2||n.length!==a.length)return r;if(null==e||isNaN(+e))return r;if(+e<=t.breaks[0])return a[0];if(+e>=t.breaks[t.breaks.length-1])return a[n.length-1];var i=null;if(n.forEach((function(t,a){a&&n[a-1]<=+e&&n[a]>=+e&&(i=a)})),null===i)return r;var o=(+e-n[i-1])/(n[i]-n[i-1]);return isFinite(o)?A.interpolate(a[i-1],a[i])(o):r};function Oe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ze(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ze(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}for(var Ee=new v,je=0,Me=Object.entries(i);je<Me.length;je++){var Pe=Oe(Me[je],2),Ae=Pe[0],Re=Pe[1];Ee.add(Ae,Re)}Ee.add("if",be);var Ne=Ee;function Te(t){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ie(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var De={type:"",filters:null,fields:[],x_axis:{},y_axis:{},tooltip_positioning:"horizontal"},Ce=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initialized=!1,this.layout_idx=null,this.id=null,this._base_id=null,this.parent=n||null,this.svg={},this.parent_plot=null,n&&(this.parent_plot=n.parent),this.layout=Object(rt.c)(e||{},De),this.layout.id&&(this.id=this.layout.id),this._filter_func=null,this.layout.x_axis!=={}&&"number"!=typeof this.layout.x_axis.axis&&(this.layout.x_axis.axis=1),this.layout.y_axis!=={}&&"number"!=typeof this.layout.y_axis.axis&&(this.layout.y_axis.axis=1),this._base_layout=Object(rt.b)(this.layout),this.state={},this.state_id=null,this.layer_state=null,this._setDefaultState(),this.data=[],this.layout.tooltip&&(this.tooltips={}),this.global_statuses={highlighted:!1,selected:!1,faded:!1,hidden:!1}}var e,n,a;return e=t,(n=[{key:"render",value:function(){throw new Error("Method must be implemented")}},{key:"moveForward",value:function(){return this.parent.data_layer_ids_by_z_index[this.layout.z_index+1]&&(this.parent.data_layer_ids_by_z_index[this.layout.z_index]=this.parent.data_layer_ids_by_z_index[this.layout.z_index+1],this.parent.data_layer_ids_by_z_index[this.layout.z_index+1]=this.id,this.parent.resortDataLayers()),this}},{key:"moveBack",value:function(){return this.parent.data_layer_ids_by_z_index[this.layout.z_index-1]&&(this.parent.data_layer_ids_by_z_index[this.layout.z_index]=this.parent.data_layer_ids_by_z_index[this.layout.z_index-1],this.parent.data_layer_ids_by_z_index[this.layout.z_index-1]=this.id,this.parent.resortDataLayers()),this}},{key:"setElementAnnotation",value:function(t,e,n){var a=this.getElementId(t);return this.layer_state.extra_fields[a]||(this.layer_state.extra_fields[a]={}),this.layer_state.extra_fields[a][e]=n,this}},{key:"setFilter",value:function(t){this._filter_func=t}},{key:"_getDataExtent",value:function(t,e){return t=t||this.data,A.extent(t,(function(t){return+new at(e.field).resolve(t)}))}},{key:"getElementId",value:function(t){var e=Symbol.for("lzID");if(t[e])return t[e];var n=this.layout.id_field||"id";if(void 0===t[n])throw new Error("Unable to generate element ID");var a=t[n].toString().replace(/\W/g,""),r="".concat(this.getBaseId(),"-").concat(a).replace(/([:.[\],])/g,"_");return t[e]=r,r}},{key:"getElementStatusNodeId",value:function(t){return null}},{key:"getElementById",value:function(t){var e=A.select("#".concat(t.replace(/([:.[\],])/g,"\\$1")));return!e.empty()&&e.data()&&e.data().length?e.data()[0]:null}},{key:"applyDataMethods",value:function(){var t=this,e=this.layout.match&&this.layout.match.receive,n=this.parent_plot.state.lz_match_value;return this.data.forEach((function(a,r){e&&null!=n&&(a.lz_highlight_match=a[e]===n),a.toHTML=function(){var e=t.layout.id_field||"id",n="";return a[e]&&(n=a[e].toString()),n},a.getDataLayer=function(){return t},a.getPanel=function(){return t.parent||null},a.getPlot=function(){var e=t.parent;return e?e.parent:null},a.deselect=function(){t.getDataLayer().unselectElement(t)}})),this.applyCustomDataMethods(),this}},{key:"applyCustomDataMethods",value:function(){return this}},{key:"resolveScalableParameter",value:function(t,e,n){var a=null;if(Array.isArray(t))for(var r=0;null===a&&r<t.length;)a=this.resolveScalableParameter(t[r],e,n),r++;else switch(Te(t)){case"number":case"string":a=t;break;case"object":if(t.scale_function){var i=Ne.get(t.scale_function);if(t.field){var o,s=new at(t.field);try{o=this.layer_state&&this.layer_state.extra_fields[this.getElementId(e)]}catch(t){o=null}a=i(t.parameters||{},s.resolve(e,o),n)}else a=i(t.parameters||{},e,n)}}return a}},{key:"getAxisExtent",value:function(t){if(!["x","y"].includes(t))throw new Error("Invalid dimension identifier");var e="".concat(t,"_axis"),n=this.layout[e];if(!isNaN(n.floor)&&!isNaN(n.ceiling))return[+n.floor,+n.ceiling];var a=[];if(n.field&&this.data){if(this.data.length){var r=(a=this._getDataExtent(this.data,n))[1]-a[0];if(isNaN(n.lower_buffer)||(a[0]-=r*n.lower_buffer),isNaN(n.upper_buffer)||(a[1]+=r*n.upper_buffer),"object"==Te(n.min_extent)){var i=n.min_extent[0],o=n.min_extent[1];isNaN(i)||isNaN(o)||(a[0]=Math.min(a[0],i)),isNaN(o)||(a[1]=Math.max(a[1],o))}return[isNaN(n.floor)?a[0]:n.floor,isNaN(n.ceiling)?a[1]:n.ceiling]}return a=n.min_extent||[]}return"x"!==t||isNaN(this.state.start)||isNaN(this.state.end)?[]:[this.state.start,this.state.end]}},{key:"getTicks",value:function(t,e){if(!["x","y1","y2"].includes(t))throw new Error("Invalid dimension identifier ".concat(t));return[]}},{key:"_getTooltipPosition",value:function(t){var e=this.parent,n=e["y".concat(this.layout.y_axis.axis,"_scale")],a=e["y".concat(this.layout.y_axis.axis,"_extent")],r=e.x_scale(e.x_extent[0]),i=n(a[0]);return{x_min:r,x_max:r,y_min:i,y_max:i}}},{key:"_drawTooltip",value:function(t,e,n,a,r,i){var o,s,l,c,u,h=this.parent.layout,d=this.layout,p=this._getPageOrigin(),f=t.selector.node().getBoundingClientRect(),y=h.height-(h.margin.top+h.margin.bottom),_=h.width-(h.margin.left+h.margin.right),g=((n=Math.max(n,0))+(a=Math.min(a,_)))/2,m=((r=Math.max(r,0))+(i=Math.min(i,y)))/2,v=a-g,b=i-m,x=d.tooltip_positioning;if("vertical"===x?(v=0,x=f.height+8>y-(m+b)?"top":"bottom"):"horizontal"===x&&(b=0,x=g<=h.width/2?"left":"right"),"top"===x||"bottom"===x){var w=Math.max(f.width/2-g,0),k=Math.max(f.width/2+g-_,0);s=p.x+g-f.width/2-k+w,u=p.x+g-s-7,"top"===x?(o=p.y+m-(b+f.height+8),l="down",c=f.height-1):(o=p.y+m+b+8,l="up",c=-8)}else{if("left"!==x&&"right"!==x)throw new Error("Unrecognized placement value");"left"===x?(s=p.x+g+v+8,l="left",u=-8):(s=p.x+g-f.width-v-8,l="right",u=f.width-1),m-f.height/2<=0?(o=p.y+m-10.5-6,c=6):m+f.height/2>=y?(o=p.y+m+7+6-f.height,c=f.height-14-6):(o=p.y+m-f.height/2,c=f.height/2-7)}return t.selector.style("left","".concat(s,"px")).style("top","".concat(o,"px")),t.arrow||(t.arrow=t.selector.append("div").style("position","absolute")),t.arrow.attr("class","lz-data_layer-tooltip-arrow_".concat(l)).style("left","".concat(u,"px")).style("top","".concat(c,"px")),this}},{key:"filter",value:function(t,e,n,a){var r=this,i=!0;return t.forEach((function(t){(function(t,e){var n=e.field,a=e.operator,i=e.value,o=r.layer_state.extra_fields[r.getElementId(t)],s=new at(n).resolve(t,o);return{"=":function(t,e){return t===e},"!=":function(t,e){return t!=e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"%":function(t,e){return t%e},in:function(t,e){return e&&e.includes(t)},match:function(t,e){return t&&t.includes(e)}}[a](s,i)})(e,t)||(i=!1)})),i}},{key:"getElementAnnotation",value:function(t,e){var n=this.getElementId(t),a=this.layer_state.extra_fields[n];return a&&a[e]}},{key:"_applyFilters",value:function(t){return t=t||this.data,this._filter_func?t=t.filter(this._filter_func):this.layout.filters&&(t=t.filter(this.filter.bind(this,this.layout.filters))),t}},{key:"_setDefaultState",value:function(){var t={status_flags:{},extra_fields:{}},e=t.status_flags;R.adjectives.forEach((function(t){e[t]=e[t]||[]})),e.has_tooltip=e.has_tooltip||[],this.parent&&(this.state_id="".concat(this.parent.id,".").concat(this.id),this.state=this.parent.state,this.state[this.state_id]=t),this.layer_state=t}},{key:"getBaseId",value:function(){return this._base_id?this._base_id:this.parent?"".concat(this.parent_plot.id,".").concat(this.parent.id,".").concat(this.id):(this.id||"").toString()}},{key:"getAbsoluteDataHeight",value:function(){return this.svg.group.node().getBoundingClientRect().height}},{key:"initialize",value:function(){this._base_id=this.getBaseId();var t=this.getBaseId();return this.svg.container=this.parent.svg.group.append("g").attr("class","lz-data_layer-container").attr("id","".concat(t,".data_layer_container")),this.svg.clipRect=this.svg.container.append("clipPath").attr("id","".concat(t,".clip")).append("rect"),this.svg.group=this.svg.container.append("g").attr("id","".concat(t,".data_layer")).attr("clip-path","url(#".concat(t,".clip)")),this}},{key:"createTooltip",value:function(t){if("object"!=Te(this.layout.tooltip))throw new Error("DataLayer [".concat(this.id,"] layout does not define a tooltip"));var e=this.getElementId(t);if(!this.tooltips[e])return this.tooltips[e]={data:t,arrow:null,selector:A.select(this.parent_plot.svg.node().parentNode).append("div").attr("class","lz-data_layer-tooltip").attr("id","".concat(e,"-tooltip"))},this.layer_state.status_flags.has_tooltip.push(e),this.updateTooltip(t),this;this.positionTooltip(e)}},{key:"updateTooltip",value:function(t,e){var n=this;return void 0===e&&(e=this.getElementId(t)),this.tooltips[e].selector.html(""),this.tooltips[e].arrow=null,this.layout.tooltip.html&&this.tooltips[e].selector.html(ve(t,this.layout.tooltip.html)),this.layout.tooltip.closable&&this.tooltips[e].selector.insert("button",":first-child").attr("class","lz-tooltip-close-button").attr("title","Close").text("×").on("click",(function(){n.destroyTooltip(e)})),this.tooltips[e].selector.data([t]),this.positionTooltip(e),this}},{key:"destroyTooltip",value:function(t,e){var n;if(n="string"==typeof t?t:this.getElementId(t),this.tooltips[n]&&("object"==Te(this.tooltips[n].selector)&&this.tooltips[n].selector.remove(),delete this.tooltips[n]),!e){var a=this.layer_state.status_flags.has_tooltip,r=a.indexOf(n);a.splice(r,1)}return this}},{key:"destroyAllTooltips",value:function(){for(var t in this.tooltips)this.destroyTooltip(t,!0);return this}},{key:"positionTooltip",value:function(t){if("string"!=typeof t)throw new Error("Unable to position tooltip: id is not a string");if(!this.tooltips[t])throw new Error("Unable to position tooltip: id does not point to a valid tooltip");var e=this.tooltips[t],n=this._getTooltipPosition(e);if(!n)return null;this._drawTooltip(e,this.layout.tooltip_positioning,n.x_min,n.x_max,n.y_min,n.y_max)}},{key:"positionAllTooltips",value:function(){for(var t in this.tooltips)this.positionTooltip(t);return this}},{key:"showOrHideTooltip",value:function(t,e){if("object"!=Te(this.layout.tooltip))return this;var n=this.getElementId(t),a=function t(e,n,a){var r=null;if("object"!=Te(e)||null===e)return null;if(Array.isArray(n))a=a||"and",r=1===n.length?e[n[0]]:n.reduce((function(t,n){return"and"===a?e[t]&&e[n]:"or"===a?e[t]||e[n]:null}));else{if("object"!=Te(n))return!1;var i;for(var o in n)i=t(e,n[o],o),null===r?r=i:"and"===a?r=r&&i:"or"===a&&(r=r||i)}return r},r={};"string"==typeof this.layout.tooltip.show?r={and:[this.layout.tooltip.show]}:"object"==Te(this.layout.tooltip.show)&&(r=this.layout.tooltip.show);var i={};"string"==typeof this.layout.tooltip.hide?i={and:[this.layout.tooltip.hide]}:"object"==Te(this.layout.tooltip.hide)&&(i=this.layout.tooltip.hide);var o=this.layer_state,s={};R.adjectives.forEach((function(t){var e="un".concat(t);s[t]=o.status_flags[t].includes(n),s[e]=!s[t]}));var l=a(s,r),c=a(s,i),u=o.status_flags.has_tooltip.includes(n);return!l||!e&&!u||c?this.destroyTooltip(t):this.createTooltip(t),this}},{key:"setElementStatus",value:function(t,e,n,a){if("has_tooltip"===t)return this;var r;void 0===n&&(n=!0);try{r=this.getElementId(e)}catch(t){return this}a&&this.setAllElementStatus(t,!n),A.select("#".concat(r)).classed("lz-data_layer-".concat(this.layout.type,"-").concat(t),n);var i=this.getElementStatusNodeId(e);null!==i&&A.select("#".concat(i)).classed("lz-data_layer-".concat(this.layout.type,"-statusnode-").concat(t),n);var o=this.layer_state.status_flags[t].indexOf(r),s=-1===o;n&&s&&this.layer_state.status_flags[t].push(r),n||s||this.layer_state.status_flags[t].splice(o,1),this.showOrHideTooltip(e,s),s&&this.parent.emit("layout_changed",!0);var l="selected"===t;!l||!s&&n||this.parent.emit("element_selection",{element:e,active:n},!0);var c=this.layout.match&&this.layout.match.send;return l&&c&&(s||!n)&&this.parent.emit("match_requested",{value:e[c],active:n},!0),this}},{key:"setAllElementStatus",value:function(t,e){var n=this;if(void 0===t||!R.adjectives.includes(t))throw new Error("Invalid status");return void 0===this.layer_state.status_flags[t]||(void 0===e&&(e=!0),e?this.data.forEach((function(e){return n.setElementStatus(t,e,!0)})):(this.layer_state.status_flags[t].slice().forEach((function(e){var a=n.getElementById(e);"object"==Te(a)&&null!==a&&n.setElementStatus(t,a,!1)})),this.layer_state.status_flags[t]=[]),this.global_statuses[t]=e),this}},{key:"applyBehaviors",value:function(t){var e=this;"object"==Te(this.layout.behaviors)&&Object.keys(this.layout.behaviors).forEach((function(n){var a=/(click|mouseover|mouseout)/.exec(n);a&&t.on("".concat(a[0],".").concat(n),e.executeBehaviors(n,e.layout.behaviors[n]))}))}},{key:"executeBehaviors",value:function(t,e){var n=t.includes("ctrl"),a=t.includes("shift"),r=this;return function(t){t=t||A.select(A.event.target).datum(),n===!!A.event.ctrlKey&&a===!!A.event.shiftKey&&e.forEach((function(e){if("object"==Te(e)&&null!==e){var n=r.layer_state.status_flags[e.status].includes(r.getElementId(t)),a=e.exclusive&&!n;switch(e.action){case"set":r.setElementStatus(e.status,t,!0,e.exclusive);break;case"unset":r.setElementStatus(e.status,t,!1,e.exclusive);break;case"toggle":r.setElementStatus(e.status,t,!n,a);break;case"link":if("string"==typeof e.href){var i=ve(t,e.href);"string"==typeof e.target?window.open(i,e.target):window.location.href=i}}}}))}}},{key:"_getPageOrigin",value:function(){var t=this.parent._getPageOrigin();return{x:t.x+this.parent.layout.margin.left,y:t.y+this.parent.layout.margin.top}}},{key:"applyAllElementStatus",value:function(){var t=this,e=this.layer_state.status_flags,n=this,a=function(a){if(!Object.prototype.hasOwnProperty.call(e,a))return"continue";Array.isArray(e[a])&&e[a].forEach((function(e){try{t.setElementStatus(a,t.getElementById(e),!0)}catch(t){console.warn("Unable to apply state: ".concat(n.state_id,", ").concat(a)),console.error(t)}}))};for(var r in e)a(r)}},{key:"draw",value:function(){return this.svg.container.attr("transform","translate(".concat(this.parent.layout.cliparea.origin.x,", ").concat(this.parent.layout.cliparea.origin.y,")")),this.svg.clipRect.attr("width",this.parent.layout.cliparea.width).attr("height",this.parent.layout.cliparea.height),this.positionAllTooltips(),this}},{key:"reMap",value:function(){var t=this;return this.destroyAllTooltips(),this.parent_plot.lzd.getData(this.state,this.layout.fields).then((function(e){t.data=e.body,t.applyDataMethods(),t.initialized=!0}))}}])&&Ie(e.prototype,n),a&&Ie(e,a),t}();function Le(t){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ue(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Fe(t,e){return(Fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=He(t);if(e){var r=He(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Ge(this,n)}}function Ge(t,e){return!e||"object"!==Le(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function He(t){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}R.verbs.forEach((function(t,e){var n=R.adjectives[e],a="un".concat(t);Ce.prototype["".concat(t,"Element")]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatus(n,t,!0,e),this},Ce.prototype["".concat(a,"Element")]=function(t,e){return e=void 0!==e&&!!e,this.setElementStatus(n,t,!1,e),this},Ce.prototype["".concat(t,"AllElements")]=function(){return this.setAllElementStatus(n,!0),this},Ce.prototype["".concat(a,"AllElements")]=function(){return this.setAllElementStatus(n,!1),this}}));var Ze={color:"#000000",filters:null,tooltip_positioning:"vertical",hitarea_width:8},Ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fe(t,e)}(i,t);var e,n,a,r=qe(i);function i(t){if(Be(this,i),!Array.isArray(t.filters))throw new Error("Annotation track must specify array of filters for selecting points to annotate");return Object(rt.c)(t,Ze),r.apply(this,arguments)}return e=i,(n=[{key:"render",value:function(){var t=this,e=this._applyFilters(),n=this.svg.group.select("g.lz-data_layer-".concat(this.layout.type,"-visible_lines"));0===n.size()&&(n=this.svg.group.append("g").attr("class","lz-data_layer-".concat(this.layout.type,"-visible_lines")));var a=n.selectAll("rect.lz-data_layer-".concat(this.layout.type)).data(e,(function(e){return e[t.layout.id_field]}));a.enter().append("rect").attr("class","lz-data_layer-".concat(this.layout.type)).attr("id",(function(e){return t.getElementId(e)})).merge(a).attr("x",(function(e){return t.parent.x_scale(e[t.layout.x_axis.field])-.5})).attr("width",1).attr("height",this.parent.layout.height).attr("fill",(function(e,n){return t.resolveScalableParameter(t.layout.color,e,n)})),a.exit().remove();var r=this.svg.group.select("g.lz-data_layer-".concat(this.layout.type,"-hit_areas"));0===r.size()&&(r=this.svg.group.append("g").attr("class","lz-data_layer-".concat(this.layout.type,"-hit_areas")));var i=r.selectAll("rect.lz-data_layer-".concat(this.layout.type)).data(e,(function(e){return e[t.layout.id_field]})),o=function(n,a){var r=t.parent.x_scale(n[t.layout.x_axis.field]),i=r-t.layout.hitarea_width/2;if(a>=1){var o=e[a-1],s=t.parent.x_scale(o[t.layout.x_axis.field]);i=Math.max(i,(r+s)/2)}return[i,r]};i.enter().append("rect").attr("class","lz-data_layer-".concat(this.layout.type)).attr("id",(function(e){return t.getElementId(e)})).merge(i).attr("height",this.parent.layout.height).attr("opacity",0).attr("x",(function(t,e){return o(t,e)[0]})).attr("width",(function(e,n){var a=o(e,n);return a[1]-a[0]+t.layout.hitarea_width/2})),this.svg.group.call(this.applyBehaviors.bind(this)),i.exit().remove()}},{key:"_getTooltipPosition",value:function(t){var e=this.parent,n=e.layout.height-(e.layout.margin.top+e.layout.margin.bottom),a=e.x_scale(t.data[this.layout.x_axis.field]),r=n/2;return{x_min:a-1,x_max:a+1,y_min:r-e.layout.margin.top,y_max:r+e.layout.margin.bottom}}}])&&Ue(e.prototype,n),a&&Ue(e,a),i}(Ce);function $e(t){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ve(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Ye(t,e){return(Ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function We(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Qe(t);if(e){var r=Qe(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Xe(this,n)}}function Xe(t,e){return!e||"object"!==$e(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Qe(t){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tn={color:"seagreen",hitarea_width:"10px",style:{fill:"none","stroke-width":"1px","stroke-opacity":"100%"},tooltip_positioning:"top"},en=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ye(t,e)}(i,t);var e,n,a,r=We(i);function i(t){return Je(this,i),t=Object(rt.c)(t,tn),r.apply(this,arguments)}return e=i,(n=[{key:"render",value:function(){var t=this,e=this.layout,n=this.parent.x_scale,a=this.parent["y".concat(e.y_axis.axis,"_scale")],r=this._applyFilters();function i(t){var r=t[e.x_axis.field1],i=t[e.x_axis.field2],o=(r+i)/2,s=[[n(r),a(0)],[n(o),a(t[e.y_axis.field])],[n(i),a(0)]];return A.line().x((function(t){return t[0]})).y((function(t){return t[1]})).curve(A.curveNatural)(s)}var o=this.svg.group.selectAll("path.lz-data_layer-arcs").data(r,(function(e){return t.getElementId(e)})),s=this.svg.group.selectAll("path.lz-data_layer-arcs-hitarea").data(r,(function(e){return t.getElementId(e)}));return this.svg.group.call(dt,e.style),o.enter().append("path").attr("class","lz-data_layer-arcs").attr("id",(function(e){return t.getElementId(e)})).merge(o).attr("stroke",(function(e,n){return t.resolveScalableParameter(t.layout.color,e,n)})).attr("d",(function(t,e){return i(t)})),s.enter().append("path").attr("class","lz-data_layer-arcs-hitarea").attr("id",(function(e){return t.getElementId(e)})).merge(s).style("fill","none").style("stroke-width",e.hitarea_width).style("stroke-opacity",0).style("stroke","transparent").attr("d",(function(t){return i(t)})),o.exit().remove(),s.exit().remove(),this.svg.group.call(this.applyBehaviors.bind(this)),this}},{key:"_getTooltipPosition",value:function(t){var e=this.parent,n=this.layout,a=t.data[n.x_axis.field1],r=t.data[n.x_axis.field2],i=e["y".concat(n.y_axis.axis,"_scale")];return{x_min:e.x_scale(Math.min(a,r)),x_max:e.x_scale(Math.max(a,r)),y_min:i(t.data[n.y_axis.field]),y_max:i(0)}}}])&&Ve(e.prototype,n),a&&Ve(e,a),i}(Ce);function nn(t,e,n){return(nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dn(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function an(t){return(an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function on(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function sn(t,e,n){return e&&on(t.prototype,e),n&&on(t,n),t}function ln(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&cn(t,e)}function cn(t,e){return(cn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=dn(t);if(e){var r=dn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return hn(this,n)}}function hn(t,e){return!e||"object"!==an(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function dn(t){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pn={point_size:40,point_shape:"square",color:"#888888",fill_opacity:1,y_axis:{axis:2},id_field:"id",confidence_intervals:{start_field:"ci_start",end_field:"ci_end"},show_no_significance_line:!0},fn=function(t){ln(n,t);var e=un(n);function n(t){return rn(this,n),t=Object(rt.c)(t,pn),e.apply(this,arguments)}return sn(n,[{key:"_getTooltipPosition",value:function(t){var e=this.parent.x_scale(t.data[this.layout.x_axis.field]),n="y".concat(this.layout.y_axis.axis,"_scale"),a=this.parent[n](t.data[this.layout.y_axis.field]),r=this.resolveScalableParameter(this.layout.point_size,t.data),i=Math.sqrt(r/Math.PI);return{x_min:e-i,x_max:e+i,y_min:a-i,y_max:a+i}}},{key:"render",value:function(){var t=this,e=this._applyFilters(),n="y".concat(this.layout.y_axis.axis,"_scale");if(this.layout.confidence_intervals&&this.layout.fields.includes(this.layout.confidence_intervals.start_field)&&this.layout.fields.includes(this.layout.confidence_intervals.end_field)){var a=this.svg.group.selectAll("rect.lz-data_layer-forest.lz-data_layer-forest-ci").data(e,(function(e){return e[t.layout.id_field]}));a.enter().append("rect").attr("class","lz-data_layer-forest lz-data_layer-forest-ci").attr("id",(function(e){return"".concat(t.getElementId(e),"_ci")})).attr("transform","translate(0, ".concat(isNaN(this.parent.layout.height)?0:this.parent.layout.height,")")).merge(a).attr("transform",(function(e){var a=t.parent.x_scale(e[t.layout.confidence_intervals.start_field]),r=t.parent[n](e[t.layout.y_axis.field]);return isNaN(a)&&(a=-1e3),isNaN(r)&&(r=-1e3),"translate(".concat(a,", ").concat(r,")")})).attr("width",(function(e){return t.parent.x_scale(e[t.layout.confidence_intervals.end_field])-t.parent.x_scale(e[t.layout.confidence_intervals.start_field])})).attr("height",1),a.exit().remove()}var r=this.svg.group.selectAll("path.lz-data_layer-forest.lz-data_layer-forest-point").data(e,(function(e){return e[t.layout.id_field]})),i=isNaN(this.parent.layout.height)?0:this.parent.layout.height,o=A.symbol().size((function(e,n){return t.resolveScalableParameter(t.layout.point_size,e,n)})).type((function(e,n){return Object(rt.d)(t.resolveScalableParameter(t.layout.point_shape,e,n))}));r.enter().append("path").attr("class","lz-data_layer-forest lz-data_layer-forest-point").attr("id",(function(e){return t.getElementId(e)})).attr("transform","translate(0, ".concat(i,")")).merge(r).attr("transform",(function(e){var a=t.parent.x_scale(e[t.layout.x_axis.field]),r=t.parent[n](e[t.layout.y_axis.field]);return isNaN(a)&&(a=-1e3),isNaN(r)&&(r=-1e3),"translate(".concat(a,", ").concat(r,")")})).attr("fill",(function(e,n){return t.resolveScalableParameter(t.layout.color,e,n)})).attr("fill-opacity",(function(e,n){return t.resolveScalableParameter(t.layout.fill_opacity,e,n)})).attr("d",o),r.exit().remove(),this.svg.group.on("click.event_emitter",(function(e){t.parent.emit("element_clicked",e,!0)})).call(this.applyBehaviors.bind(this))}}]),n}(Ce),yn=function(t){ln(n,t);var e=un(n);function n(){return rn(this,n),e.apply(this,arguments)}return sn(n,[{key:"_getDataExtent",value:function(t,e){var a=this.layout.confidence_intervals;if(a&&this.layout.fields.includes(a.start_field)&&this.layout.fields.includes(a.end_field)){return[A.min(t,(function(t){return+new at(a.start_field).resolve(t)})),A.max(t,(function(t){return+new at(a.end_field).resolve(t)}))]}return nn(dn(n.prototype),"_getDataExtent",this).call(this,t,e)}},{key:"getTicks",value:function(t,e){if(!["x","y1","y2"].includes(t))throw new Error("Invalid dimension identifier ".concat(t));var n=this.layout.y_axis.axis;if(t==="y".concat(n)){var a=this.layout.y_axis.category_field;if(!a)throw new Error("Layout for ".concat(this.layout.id," must specify category_field"));return this.data.map((function(t,e){return{y:e+1,text:t[a]}}))}return[]}},{key:"applyCustomDataMethods",value:function(){var t=this.layout.y_axis.field;if(!t)throw new Error("Layout for ".concat(this.layout.id," must specify yaxis.field"));return this.data=this.data.map((function(e,n){return e[t]=n+1,e})),this.layout.y_axis.floor=0,this.layout.y_axis.ceiling=this.data.length+1,this}}]),n}(fn);function _n(t){return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mn(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function vn(t,e){return(vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=wn(t);if(e){var r=wn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return xn(this,n)}}function xn(t,e){return!e||"object"!==_n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function wn(t){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var kn={stroke:"rgb(54, 54, 150)",color:"#363696",label_font_size:12,label_exon_spacing:3,exon_height:10,bounding_box_padding:3,track_vertical_spacing:5,tooltip_positioning:"top"},Sn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}(i,t);var e,n,a,r=bn(i);function i(t){var e;return gn(this,i),t=Object(rt.c)(t,kn),(e=r.apply(this,arguments)).transcript_idx=0,e.tracks=1,e.gene_track_index={1:[]},e}return e=i,(n=[{key:"getElementStatusNodeId",value:function(t){return"".concat(this.getElementId(t),"-statusnode")}},{key:"getTrackHeight",value:function(){return 2*this.layout.bounding_box_padding+this.layout.label_font_size+this.layout.label_exon_spacing+this.layout.exon_height+this.layout.track_vertical_spacing}},{key:"assignTracks",value:function(t){var e=this;return this.tracks=1,this.gene_track_index={1:[]},t.map((function(t){if(t.gene_id&&t.gene_id.indexOf(".")){var n=t.gene_id.split(".");t.gene_id=n[0],t.gene_version=n[1]}if(t.transcript_id=t.transcripts[e.transcript_idx].transcript_id,t.display_range={start:e.parent.x_scale(Math.max(t.start,e.state.start)),end:e.parent.x_scale(Math.min(t.end,e.state.end))},t.display_range.label_width=function(t,n){try{var a=e.svg.group.append("text").attr("x",0).attr("y",0).attr("class","lz-data_layer-genes lz-label").style("font-size",n).text("".concat(t,"→")),r=a.node().getBBox().width;return a.remove(),r}catch(t){return 0}}(t.gene_name,e.layout.label_font_size),t.display_range.width=t.display_range.end-t.display_range.start,t.display_range.text_anchor="middle",t.display_range.width<t.display_range.label_width){if(t.start<e.state.start)t.display_range.end=t.display_range.start+t.display_range.label_width+e.layout.label_font_size,t.display_range.text_anchor="start";else if(t.end>e.state.end)t.display_range.start=t.display_range.end-t.display_range.label_width-e.layout.label_font_size,t.display_range.text_anchor="end";else{var a=(t.display_range.label_width-t.display_range.width)/2+e.layout.label_font_size;t.display_range.start-a<e.parent.x_scale(e.state.start)?(t.display_range.start=e.parent.x_scale(e.state.start),t.display_range.end=t.display_range.start+t.display_range.label_width,t.display_range.text_anchor="start"):t.display_range.end+a>e.parent.x_scale(e.state.end)?(t.display_range.end=e.parent.x_scale(e.state.end),t.display_range.start=t.display_range.end-t.display_range.label_width,t.display_range.text_anchor="end"):(t.display_range.start-=a,t.display_range.end+=a)}t.display_range.width=t.display_range.end-t.display_range.start}t.display_range.start-=e.layout.bounding_box_padding,t.display_range.end+=e.layout.bounding_box_padding,t.display_range.width+=2*e.layout.bounding_box_padding,t.display_domain={start:e.parent.x_scale.invert(t.display_range.start),end:e.parent.x_scale.invert(t.display_range.end)},t.display_domain.width=t.display_domain.end-t.display_domain.start,t.track=null;for(var r=1,i=function(){var n=!1;e.gene_track_index[r].map((function(e){if(!n){var a=Math.min(e.display_range.start,t.display_range.start);Math.max(e.display_range.end,t.display_range.end)-a<e.display_range.width+t.display_range.width&&(n=!0)}})),n?++r>e.tracks&&(e.tracks=r,e.gene_track_index[r]=[]):(t.track=r,e.gene_track_index[r].push(t))};null===t.track;)i();t.parent=e,t.transcripts.map((function(e,n){t.transcripts[n].parent=t,t.transcripts[n].exons.map((function(e,a){return t.transcripts[n].exons[a].parent=t.transcripts[n]}))}))})),this}},{key:"render",value:function(){var t,e=this,n=this,a=this._applyFilters();this.assignTracks(a);var r=this.svg.group.selectAll("g.lz-data_layer-genes").data(a,(function(t){return t.gene_name}));r.enter().append("g").attr("class","lz-data_layer-genes").merge(r).attr("id",(function(t){return e.getElementId(t)})).each((function(e){var a=e.parent,r=A.select(this).selectAll("rect.lz-data_layer-genes.lz-data_layer-genes-statusnode").data([e],(function(t){return a.getElementStatusNodeId(t)}));t=a.getTrackHeight()-a.layout.track_vertical_spacing,r.enter().append("rect").attr("class","lz-data_layer-genes lz-data_layer-genes-statusnode").merge(r).attr("id",(function(t){return a.getElementStatusNodeId(t)})).attr("rx",a.layout.bounding_box_padding).attr("ry",a.layout.bounding_box_padding).attr("width",(function(t){return t.display_range.width})).attr("height",t).attr("x",(function(t){return t.display_range.start})).attr("y",(function(t){return(t.track-1)*a.getTrackHeight()})),r.exit().remove();var i=A.select(this).selectAll("rect.lz-data_layer-genes.lz-boundary").data([e],(function(t){return"".concat(t.gene_name,"_boundary")}));t=1,i.enter().append("rect").attr("class","lz-data_layer-genes lz-boundary").merge(i).attr("width",(function(t){return a.parent.x_scale(t.end)-a.parent.x_scale(t.start)})).attr("height",t).attr("x",(function(t){return a.parent.x_scale(t.start)})).attr("y",(function(t){return(t.track-1)*a.getTrackHeight()+a.layout.bounding_box_padding+a.layout.label_font_size+a.layout.label_exon_spacing+Math.max(a.layout.exon_height,3)/2})).style("fill",(function(t,e){return n.resolveScalableParameter(n.layout.color,t,e)})).style("stroke",(function(t,e){return n.resolveScalableParameter(n.layout.stroke,t,e)})),i.exit().remove();var o=A.select(this).selectAll("text.lz-data_layer-genes.lz-label").data([e],(function(t){return"".concat(t.gene_name,"_label")}));o.enter().append("text").attr("class","lz-data_layer-genes lz-label").merge(o).attr("text-anchor",(function(t){return t.display_range.text_anchor})).text((function(t){return"+"===t.strand?"".concat(t.gene_name,"→"):"←".concat(t.gene_name)})).style("font-size",e.parent.layout.label_font_size).attr("x",(function(t){return"middle"===t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"===t.display_range.text_anchor?t.display_range.start+a.layout.bounding_box_padding:"end"===t.display_range.text_anchor?t.display_range.end-a.layout.bounding_box_padding:void 0})).attr("y",(function(t){return(t.track-1)*a.getTrackHeight()+a.layout.bounding_box_padding+a.layout.label_font_size})),o.exit().remove();var s=A.select(this).selectAll("rect.lz-data_layer-genes.lz-exon").data(e.transcripts[e.parent.transcript_idx].exons,(function(t){return t.exon_id}));t=a.layout.exon_height,s.enter().append("rect").attr("class","lz-data_layer-genes lz-exon").merge(s).style("fill",(function(t,e){return n.resolveScalableParameter(n.layout.color,t.parent.parent,e)})).style("stroke",(function(t,e){return n.resolveScalableParameter(n.layout.stroke,t.parent.parent,e)})).attr("width",(function(t){return a.parent.x_scale(t.end)-a.parent.x_scale(t.start)})).attr("height",t).attr("x",(function(t){return a.parent.x_scale(t.start)})).attr("y",(function(){return(e.track-1)*a.getTrackHeight()+a.layout.bounding_box_padding+a.layout.label_font_size+a.layout.label_exon_spacing})),s.exit().remove();var l=A.select(this).selectAll("rect.lz-data_layer-genes.lz-clickarea").data([e],(function(t){return"".concat(t.gene_name,"_clickarea")}));t=a.getTrackHeight()-a.layout.track_vertical_spacing,l.enter().append("rect").attr("class","lz-data_layer-genes lz-clickarea").merge(l).attr("id",(function(t){return"".concat(a.getElementId(t),"_clickarea")})).attr("rx",a.layout.bounding_box_padding).attr("ry",a.layout.bounding_box_padding).attr("width",(function(t){return t.display_range.width})).attr("height",t).attr("x",(function(t){return t.display_range.start})).attr("y",(function(t){return(t.track-1)*a.getTrackHeight()})),l.exit().remove()})),r.exit().remove(),this.svg.group.on("click.event_emitter",(function(t){return e.parent.emit("element_clicked",t,!0)})).call(this.applyBehaviors.bind(this))}},{key:"_getTooltipPosition",value:function(t){var e=this.getElementStatusNodeId(t.data),n=A.select("#".concat(e)).node().getBBox();return{x_min:this.parent.x_scale(t.data.start),x_max:this.parent.x_scale(t.data.end),y_min:n.y,y_max:n.y+n.height}}}])&&mn(e.prototype,n),a&&mn(e,a),i}(Ce);function On(t){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function En(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function jn(t,e,n){return e&&En(t.prototype,e),n&&En(t,n),t}function Mn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pn(t,e)}function Pn(t,e){return(Pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function An(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Nn(t);if(e){var r=Nn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Rn(this,n)}}function Rn(t,e){return!e||"object"!==On(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Nn(t){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tn={style:{fill:"none","stroke-width":"2px"},interpolate:"curveLinear",x_axis:{field:"x"},y_axis:{field:"y",axis:1},hitarea_width:5},In=function(t){Mn(n,t);var e=An(n);function n(t){if(zn(this,n),(t=Object(rt.c)(t,Tn)).tooltip)throw new Error("The line / filled curve layer does not support tooltips");return e.apply(this,arguments)}return jn(n,[{key:"render",value:function(){var t,e=this.parent,n=this.layout.x_axis.field,a=this.layout.y_axis.field,r=this.svg.group.selectAll("path.lz-data_layer-line").data([this.data]);this.path=r.enter().append("path").attr("class","lz-data_layer-line");var i=e.x_scale,o=e["y".concat(this.layout.y_axis.axis,"_scale")];t=this.layout.style.fill&&"none"!==this.layout.style.fill?A.area().x((function(t){return+i(t[n])})).y0(+o(0)).y1((function(t){return+o(t[a])})):A.line().x((function(t){return+i(t[n])})).y((function(t){return+o(t[a])})).curve(A[this.layout.interpolate]),r.merge(this.path).attr("d",t).call(dt,this.layout.style),r.exit().remove()}},{key:"setElementStatus",value:function(t,e,n){return this.setAllElementStatus(t,n)}},{key:"setAllElementStatus",value:function(t,e){var n=this;if(void 0===t||!R.adjectives.includes(t))throw new Error("Invalid status");if(void 0===this.layer_state.status_flags[t])return this;void 0===e&&(e=!0),this.global_statuses[t]=e;var a="lz-data_layer-line";return Object.keys(this.global_statuses).forEach((function(t){n.global_statuses[t]&&(a+=" lz-data_layer-line-".concat(t))})),this.path.attr("class",a),this.parent.emit("layout_changed",!0),this}}]),n}(Ce),Dn={style:{stroke:"#D3D3D3","stroke-width":"3px","stroke-dasharray":"10px 10px"},orientation:"horizontal",x_axis:{axis:1,decoupled:!0},y_axis:{axis:1,decoupled:!0},tooltip_positioning:"vertical",offset:0},Cn=function(t){Mn(n,t);var e=An(n);function n(t){var a;return zn(this,n),t=Object(rt.c)(t,Dn),["horizontal","vertical"].includes(t.orientation)||(t.orientation="horizontal"),(a=e.apply(this,arguments)).data=[],a}return jn(n,[{key:"getElementId",value:function(t){return this.getBaseId()}},{key:"render",value:function(){var t=this.parent,e="y".concat(this.layout.y_axis.axis,"_scale"),n="y".concat(this.layout.y_axis.axis,"_extent");if("horizontal"===this.layout.orientation)this.data=[{x:t.x_extent[0],y:this.layout.offset},{x:t.x_extent[1],y:this.layout.offset}];else{if("vertical"!==this.layout.orientation)throw new Error('Unrecognized vertical line type. Must be "vertical" or "horizontal"');this.data=[{x:this.layout.offset,y:t[n][0]},{x:this.layout.offset,y:t[n][1]}]}var a=this.svg.group.selectAll("path.lz-data_layer-line").data([this.data]),r=[t.layout.cliparea.height,0],i=A.line().x((function(e,n){var a=+t.x_scale(e.x);return isNaN(a)?t.x_range[n]:a})).y((function(n,a){var i=+t[e](n.y);return isNaN(i)?r[a]:i}));this.path=a.enter().append("path").attr("class","lz-data_layer-line").merge(a).attr("d",i).call(dt,this.layout.style).call(this.applyBehaviors.bind(this)),a.exit().remove()}},{key:"_getTooltipPosition",value:function(t){try{var e=A.mouse(this.svg.container.node()),n=e[0],a=e[1];return{x_min:n-1,x_max:n+1,y_min:a-1,y_max:a+1}}catch(t){return null}}}]),n}(Ce);function Ln(t){return(Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Un(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Fn(t,e,n){return e&&Un(t.prototype,e),n&&Un(t,n),t}function qn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gn(t,e)}function Gn(t,e){return(Gn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Kn(t);if(e){var r=Kn(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Zn(this,n)}}function Zn(t,e){return!e||"object"!==Ln(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Kn(t){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $n={point_size:40,point_shape:"circle",tooltip_positioning:"horizontal",color:"#888888",coalesce:{active:!1,max_points:800,x_min:"-Infinity",x_max:"Infinity",y_min:0,y_max:3,x_gap:7,y_gap:7},fill_opacity:1,y_axis:{axis:1},id_field:"id"},Jn=function(t){qn(n,t);var e=Hn(n);function n(t){return Bn(this,n),(t=Object(rt.c)(t,$n)).label&&isNaN(t.label.spacing)&&(t.label.spacing=4),e.apply(this,arguments)}return Fn(n,[{key:"_getTooltipPosition",value:function(t){var e=this.parent.x_scale(t.data[this.layout.x_axis.field]),n="y".concat(this.layout.y_axis.axis,"_scale"),a=this.parent[n](t.data[this.layout.y_axis.field]),r=this.resolveScalableParameter(this.layout.point_size,t.data),i=Math.sqrt(r/Math.PI);return{x_min:e-i,x_max:e+i,y_min:a-i,y_max:a+i}}},{key:"flip_labels",value:function(){var t=this,e=t.resolveScalableParameter(t.layout.point_size,{}),n=t.layout.label.spacing,a=Boolean(t.layout.label.lines),r=2*n,i=this.parent.layout.width-this.parent.layout.margin.left-this.parent.layout.margin.right-2*n,o=function(t,r){var i,o,s=+t.attr("x"),l=2*n+2*Math.sqrt(e);a&&(i=+r.attr("x2"),o=n+2*Math.sqrt(e)),"start"===t.style("text-anchor")?(t.style("text-anchor","end"),t.attr("x",s-l),a&&r.attr("x2",i-o)):(t.style("text-anchor","start"),t.attr("x",s+l),a&&r.attr("x2",i+o))};t.label_texts.each((function(e,r){var s=A.select(this);if(+s.attr("x")+s.node().getBoundingClientRect().width+n>i){var l=a?A.select(t.label_lines.nodes()[r]):null;o(s,l)}})),t.label_texts.each((function(e,i){var s=A.select(this);if("end"!==s.style("text-anchor")){s.attr("x");var l=s.node().getBoundingClientRect(),c=a?A.select(t.label_lines.nodes()[i]):null;t.label_texts.each((function(){var t=A.select(this).node().getBoundingClientRect();l.left<t.left+t.width+2*n&&l.left+l.width+2*n>t.left&&l.top<t.top+t.height+2*n&&l.height+l.top+2*n>t.top&&(o(s,c),+s.attr("x")-l.width-n<r&&o(s,c))}))}}))}},{key:"separate_labels",value:function(){var t=this;this.seperate_iterations++;var e=this;if(this.layout.label){var n=this.layout.label.spacing,a=!1;if(e.label_texts.each((function(){var t=this,r=A.select(t),i=r.attr("y");e.label_texts.each((function(){if(t!==this){var o=A.select(this);if(r.attr("text-anchor")===o.attr("text-anchor")){var s=r.node().getBoundingClientRect(),l=o.node().getBoundingClientRect();if(s.left<l.left+l.width+2*n&&s.left+s.width+2*n>l.left&&s.top<l.top+l.height+2*n&&s.height+s.top+2*n>l.top){a=!0;var c,u=o.attr("y"),h=.5*(s.top<l.top?1:-1),d=+i-h,p=+u+h,f=2*n,y=e.parent.layout.height-e.parent.layout.margin.top-e.parent.layout.margin.bottom-2*n;d-s.height/2<f?(c=+i-d,d=+i,p+=c):p-l.height/2<f&&(c=+u-p,p=+u,d+=c),d+s.height/2>y?(c=d-+i,d=+i,p-=c):p+l.height/2>y&&(c=p-+u,p=+u,d-=c),r.attr("y",d),o.attr("y",p)}}}}))})),a){if(e.layout.label.lines){var r=e.label_texts.nodes();e.label_lines.attr("y2",(function(t,e){return A.select(r[e]).attr("y")}))}this.seperate_iterations<150&&setTimeout((function(){t.separate_labels()}),1)}}}},{key:"render",value:function(){var t=this,e=this,n=this.parent.x_scale,a=this.parent["y".concat(this.layout.y_axis.axis,"_scale")],r=Symbol.for("lzX"),i=Symbol.for("lzY"),o=this._applyFilters();if(o.forEach((function(e){var o=n(e[t.layout.x_axis.field]),s=a(e[t.layout.y_axis.field]);isNaN(o)&&(o=-1e3),isNaN(s)&&(s=-1e3),e[r]=o,e[i]=s})),this.layout.coalesce.active&&o.length>this.layout.coalesce.max_points){var s=this.layout.coalesce,l=s.x_min,c=s.x_max,u=s.y_min,h=s.y_max,d=s.x_gap,p=s.y_gap;o=function(t,e,n,a,r,i,o){var s=[],l=Symbol.for("lzX"),c=Symbol.for("lzY"),u=null,h=null,d=[];function p(){if(d.length){var t=d[Math.floor((d.length-1)/2)];s.push(t)}u=h=null,d=[]}function f(t,e,n){u=t,h=e,d.push(n)}return t.forEach((function(t){var y=t[l],_=t[c],g=y>=e&&y<=n&&_>=r&&_<=i;if(t.lz_highlight_match||!g)p(),s.push(t);else if(null===u)f(y,_,t);else{Math.abs(y-u)<=a&&Math.abs(_-h)<=o?d.push(t):(p(),f(y,_,t))}})),p(),s}(o,isFinite(l)?n(+l):-1/0,isFinite(c)?n(+c):1/0,d,isFinite(h)?a(+h):-1/0,isFinite(u)?a(+u):1/0,p)}if(this.layout.label){var f,y=e.layout.label.filters||[];if(y.length){var _=this.filter.bind(this,y);f=o.filter(_)}else f=o;this.label_groups=this.svg.group.selectAll("g.lz-data_layer-".concat(this.layout.type,"-label")).data(f,(function(e){return"".concat(e[t.layout.id_field],"_label")}));var g="lz-data_layer-".concat(this.layout.type,"-label"),m=this.label_groups.enter().append("g").attr("class",g);this.label_texts&&this.label_texts.remove(),this.label_texts=this.label_groups.merge(m).append("text").text((function(t){return ve(t,e.layout.label.text||"")})).attr("x",(function(t){return t[r]+Math.sqrt(e.resolveScalableParameter(e.layout.point_size,t))+e.layout.label.spacing})).attr("y",(function(t){return t[i]})).attr("text-anchor","start").call(dt,e.layout.label.style||{}),e.layout.label.lines&&(this.label_lines&&this.label_lines.remove(),this.label_lines=this.label_groups.merge(m).append("line").attr("x1",(function(t){return t[r]})).attr("y1",(function(t){return t[i]})).attr("x2",(function(t){return t[r]+Math.sqrt(e.resolveScalableParameter(e.layout.point_size,t))+e.layout.label.spacing/2})).attr("y2",(function(t){return t[i]})).call(dt,e.layout.label.lines.style||{})),this.label_groups.exit().remove()}else this.label_texts&&this.label_texts.remove(),this.label_lines&&this.label_lines.remove(),this.label_groups&&this.label_groups.remove();var v=this.svg.group.selectAll("path.lz-data_layer-".concat(this.layout.type)).data(o,(function(e){return e[t.layout.id_field]})),b=A.symbol().size((function(e,n){return t.resolveScalableParameter(t.layout.point_size,e,n)})).type((function(e,n){return Object(rt.d)(t.resolveScalableParameter(t.layout.point_shape,e,n))})),x="lz-data_layer-".concat(this.layout.type);v.enter().append("path").attr("class",x).attr("id",(function(e){return t.getElementId(e)})).merge(v).attr("transform",(function(t){return"translate(".concat(t[r],", ").concat(t[i],")")})).attr("fill",(function(e,n){return t.resolveScalableParameter(t.layout.color,e,n)})).attr("fill-opacity",(function(e,n){return t.resolveScalableParameter(t.layout.fill_opacity,e,n)})).attr("d",b),v.exit().remove(),this.layout.label&&(this.flip_labels(),this.seperate_iterations=0,this.separate_labels()),this.svg.group.on("click.event_emitter",(function(){var e=A.select(A.event.target).datum();t.parent.emit("element_clicked",e,!0)})).call(this.applyBehaviors.bind(this))}},{key:"makeLDReference",value:function(t){var e=null;if(void 0===t)throw new Error("makeLDReference requires one argument of any type");e="object"==Ln(t)?this.layout.id_field&&void 0!==t[this.layout.id_field]?t[this.layout.id_field].toString():void 0!==t.id?t.id.toString():t.toString():t.toString(),this.parent_plot.applyState({ldrefvar:e})}}]),n}(Ce),Vn=function(t){qn(n,t);var e=Hn(n);function n(t){var a;return Bn(this,n),(a=e.apply(this,arguments))._categories={},a}return Fn(n,[{key:"_prepareData",value:function(){var t=this.layout.x_axis.field||"x",e=this.layout.x_axis.category_field;if(!e)throw new Error("Layout for ".concat(this.layout.id," must specify category_field"));var n=this.data.sort((function(t,n){var a=t[e],r=n[e],i="string"==typeof a?a.toLowerCase():a,o="string"==typeof r?r.toLowerCase():r;return i===o?0:i<o?-1:1}));return n.forEach((function(e,n){e[t]=e[t]||n})),n}},{key:"_generateCategoryBounds",value:function(){var t=this.layout.x_axis.category_field,e=this.layout.x_axis.field||"x",n={};this.data.forEach((function(a){var r=a[t],i=a[e],o=n[r]||[i,i];n[r]=[Math.min(o[0],i),Math.max(o[1],i)]}));var a=Object.keys(n);return this._setDynamicColorScheme(a),n}},{key:"_getColorScale",value:function(t){var e=(t=t||this.layout).color||[];if(Array.isArray(e)&&(e=e.find((function(t){return"categorical_bin"===t.scale_function}))),!e||"categorical_bin"!==e.scale_function)throw new Error("This layer requires that color options be provided as a `categorical_bin`");return e}},{key:"_setDynamicColorScheme",value:function(t){var e,n=this._getColorScale(this.layout).parameters,a=this._getColorScale(this._base_layout).parameters;if(a.categories.length&&a.values.length){var r={};a.categories.forEach((function(t){r[t]=1})),t.every((function(t){return Object.prototype.hasOwnProperty.call(r,t)}))?n.categories=a.categories:n.categories=t}else n.categories=t;for(e=a.values.length?a.values:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];e.length<t.length;)e=e.concat(e);e=e.slice(0,t.length),n.values=e}},{key:"getTicks",value:function(t,e){if(!["x","y1","y2"].includes(t))throw new Error("Invalid dimension identifier");var n=e.position||"left";if(!["left","center","right"].includes(n))throw new Error("Invalid tick position");var a=this._categories;if(!a||!Object.keys(a).length)return[];if("y"===t)return[];if("x"===t){var r=this._getColorScale(this.layout),i=r.parameters.categories||[],o=r.parameters.values||[];return Object.keys(a).map((function(t,e){var r,s=a[t];switch(n){case"left":r=s[0];break;case"center":var l=s[1]-s[0];r=s[0]+(0!==l?l:s[0])/2;break;case"right":r=s[1]}return{x:r,text:t,style:{fill:o[i.indexOf(t)]||"#000000"}}}))}}},{key:"applyCustomDataMethods",value:function(){return this.data=this._prepareData(),this._categories=this._generateCategoryBounds(),this}}]),n}(Jn);function Yn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Wn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wn(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}for(var Xn=new b,Qn=0,ta=Object.entries(o);Qn<ta.length;Qn++){var ea=Yn(ta[Qn],2),na=ea[0],aa=ea[1];Xn.add(na,aa)}var ra,ia=Xn,oa={namespace:{assoc:"assoc"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<strong>{{{{namespace[assoc]}}variant|htmlescape}}</strong><br>\n        P Value: <strong>{{{{namespace[assoc]}}log_pvalue|logtoscinotation|htmlescape}}</strong><br>\n        Ref. Allele: <strong>{{{{namespace[assoc]}}ref_allele|htmlescape}}</strong><br>\n        <a href="javascript:void(0);" \n        onclick="var data = this.parentNode.__data__;\n                 data.getDataLayer().makeLDReference(data);"\n                 >Make LD Reference</a><br>'},sa=((ra=Object(rt.b)(oa)).html+="<a href=\"javascript:void(0);\" \n                  onclick=\"var item = this.parentNode.__data__, layer = item.getDataLayer(); \n                  var current = layer.getElementAnnotation(item, 'lz_show_label'); \n                  layer.setElementAnnotation(item, 'lz_show_label', !current );\n                  layer.parent_plot.applyState();\">Toggle label</a>",ra),la={closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<h4><strong><i>{{gene_name|htmlescape}}</i></strong></h4>Gene ID: <a href="https://useast.ensembl.org/homo_sapiens/Gene/Summary?g={{gene_id|htmlescape}}&db=core" target="_blank" rel="noopener">{{gene_id|htmlescape}}</a><br>Transcript ID: <strong>{{transcript_id|htmlescape}}</strong><br>{{#if pLI}}<table><tr><th>Constraint</th><th>Expected variants</th><th>Observed variants</th><th>Const. Metric</th></tr><tr><td>Synonymous</td><td>{{exp_syn}}</td><td>{{obs_syn}}</td><td>z = {{syn_z}}<br>o/e = {{oe_syn}} ({{oe_syn_lower}} - {{oe_syn_upper}})</td></tr><tr><td>Missense</td><td>{{exp_mis}}</td><td>{{obs_mis}}</td><td>z = {{mis_z}}<br>o/e = {{oe_mis}} ({{oe_mis_lower}} - {{oe_mis_upper}})</td></tr><tr><td>pLoF</td><td>{{exp_lof}}</td><td>{{obs_lof}}</td><td>pLI = {{pLI}}<br>o/e = {{oe_lof}} ({{oe_lof_lower}} - {{oe_lof_upper}})</td></tr></table><br>{{/if}}<a href="https://gnomad.broadinstitute.org/gene/{{gene_id|htmlescape}}" target="_blank" rel="noopener">More data on gnomAD</a>'},ca={namespace:{assoc:"assoc",catalog:"catalog"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<strong>{{{{namespace[catalog]}}variant|htmlescape}}</strong><br>Catalog entries: <strong>{{n_catalog_matches|htmlescape}}</strong><br>Top Trait: <strong>{{{{namespace[catalog]}}trait|htmlescape}}</strong><br>Top P Value: <strong>{{{{namespace[catalog]}}log_pvalue|logtoscinotation}}</strong><br>More: <a href="https://www.ebi.ac.uk/gwas/search?query={{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">GWAS catalog</a> / <a href="https://www.ncbi.nlm.nih.gov/snp/{{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">dbSNP</a>'},ua={namespace:{access:"access"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"<strong>Regulatory element</strong><br>{{{{namespace[access]}}start1|htmlescape}}-{{{{namespace[access]}}end1|htmlescape}}<br><strong>Promoter</strong><br>{{{{namespace[access]}}start2|htmlescape}}-{{{{namespace[access]}}end2|htmlescape}}<br>{{#if {{namespace[access]}}target}}<strong>Target</strong>: {{{{namespace[access]}}target|htmlescape}}<br>{{/if}}<strong>Score</strong>: {{{{namespace[access]}}score|htmlescape}}"},ha={id:"significance",type:"orthogonal_line",orientation:"horizontal",offset:7.301},da={namespace:{recomb:"recomb"},id:"recombrate",type:"line",fields:["{{namespace[recomb]}}position","{{namespace[recomb]}}recomb_rate"],z_index:1,style:{stroke:"#0000FF","stroke-width":"1.5px"},x_axis:{field:"{{namespace[recomb]}}position"},y_axis:{axis:2,field:"{{namespace[recomb]}}recomb_rate",floor:0,ceiling:100}},pa={namespace:{assoc:"assoc",ld:"ld"},id:"associationpvalues",type:"scatter",coalesce:{active:!0},point_shape:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"diamond",else:"circle"}},point_size:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:80,else:40}},color:[{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"#9632b8"}},{scale_function:"numerical_bin",field:"{{namespace[ld]}}state",parameters:{breaks:[0,.2,.4,.6,.8],values:["#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"]}},"#B8B8B8"],legend:[{shape:"diamond",color:"#9632b8",size:40,label:"LD Ref Var",class:"lz-data_layer-scatter"},{shape:"circle",color:"#d43f3a",size:40,label:"1.0 > r² ≥ 0.8",class:"lz-data_layer-scatter"},{shape:"circle",color:"#eea236",size:40,label:"0.8 > r² ≥ 0.6",class:"lz-data_layer-scatter"},{shape:"circle",color:"#5cb85c",size:40,label:"0.6 > r² ≥ 0.4",class:"lz-data_layer-scatter"},{shape:"circle",color:"#46b8da",size:40,label:"0.4 > r² ≥ 0.2",class:"lz-data_layer-scatter"},{shape:"circle",color:"#357ebd",size:40,label:"0.2 > r² ≥ 0.0",class:"lz-data_layer-scatter"},{shape:"circle",color:"#B8B8B8",size:40,label:"no r² data",class:"lz-data_layer-scatter"}],label:null,fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}position","{{namespace[assoc]}}log_pvalue","{{namespace[assoc]}}log_pvalue|logtoscinotation","{{namespace[assoc]}}ref_allele","{{namespace[ld]}}state","{{namespace[ld]}}isrefvar"],id_field:"{{namespace[assoc]}}variant",z_index:2,x_axis:{field:"{{namespace[assoc]}}position"},y_axis:{axis:1,field:"{{namespace[assoc]}}log_pvalue",floor:0,upper_buffer:.1,min_extent:[0,10]},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}]},tooltip:Object(rt.b)(oa)},fa={namespace:{access:"access"},id:"coaccessibility",type:"arcs",fields:["{{namespace[access]}}start1","{{namespace[access]}}end1","{{namespace[access]}}start2","{{namespace[access]}}end2","{{namespace[access]}}id","{{namespace[access]}}target","{{namespace[access]}}score"],match:{send:"{{namespace[access]}}target",receive:"{{namespace[access]}}target"},id_field:"{{namespace[access]}}id",filters:[{field:"{{namespace[access]}}score",operator:"!=",value:null}],color:[{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!0,then:"#ff0000"}},{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!1,then:"#EAE6E6"}},{scale_function:"ordinal_cycle",parameters:{values:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"]}}],x_axis:{field1:"{{namespace[access]}}start1",field2:"{{namespace[access]}}start2"},y_axis:{axis:1,field:"{{namespace[access]}}score",upper_buffer:.1,min_extent:[0,1]},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}]},tooltip:Object(rt.b)(ua)},ya=function(){var t=Object(rt.b)(pa);return(t=Object(rt.c)({id:"associationpvaluescatalog",fill_opacity:.7},t)).tooltip.html+='{{#if {{namespace[catalog]}}rsid}}<br><a href="https://www.ebi.ac.uk/gwas/search?query={{{{namespace[catalog]}}rsid|htmlescape}}" target="_blank" rel="noopener">See hits in GWAS catalog</a>{{/if}}',t.namespace.catalog="catalog",t.fields.push("{{namespace[catalog]}}rsid","{{namespace[catalog]}}trait","{{namespace[catalog]}}log_pvalue"),t}(),_a={namespace:{phewas:"phewas"},id:"phewaspvalues",type:"category_scatter",point_shape:"circle",point_size:70,tooltip_positioning:"vertical",id_field:"{{namespace[phewas]}}id",fields:["{{namespace[phewas]}}id","{{namespace[phewas]}}log_pvalue","{{namespace[phewas]}}trait_group","{{namespace[phewas]}}trait_label"],x_axis:{field:"{{namespace[phewas]}}x",category_field:"{{namespace[phewas]}}trait_group",lower_buffer:.025,upper_buffer:.025},y_axis:{axis:1,field:"{{namespace[phewas]}}log_pvalue",floor:0,upper_buffer:.15},color:[{field:"{{namespace[phewas]}}trait_group",scale_function:"categorical_bin",parameters:{categories:[],values:[],null_value:"#B8B8B8"}}],fill_opacity:.7,tooltip:{closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:["<strong>Trait:</strong> {{{{namespace[phewas]}}trait_label|htmlescape}}<br>","<strong>Trait Category:</strong> {{{{namespace[phewas]}}trait_group|htmlescape}}<br>","<strong>P-value:</strong> {{{{namespace[phewas]}}log_pvalue|logtoscinotation|htmlescape}}<br>"].join("")},behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}]},label:{text:"{{{{namespace[phewas]}}trait_label}}",spacing:6,lines:{style:{"stroke-width":"2px",stroke:"#333333","stroke-dasharray":"2px 2px"}},filters:[{field:"{{namespace[phewas]}}log_pvalue",operator:">=",value:20}],style:{"font-size":"14px","font-weight":"bold",fill:"#333333"}}},ga={namespace:{gene:"gene",constraint:"constraint"},id:"genes",type:"genes",fields:["{{namespace[gene]}}all","{{namespace[constraint]}}all"],id_field:"gene_id",behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}]},tooltip:Object(rt.b)(la)},ma=Object(rt.c)({filters:[{field:"gene_type",operator:"in",value:["protein_coding","IG_C_gene","IG_D_gene","IG_J_gene","IG_V_gene","TR_C_gene","TR_D_gene","TR_J_gene","TR_V_gene","rRNA","Mt_rRNA","Mt_tRNA"]}]},Object(rt.b)(ga)),va={namespace:{assoc:"assoc",catalog:"catalog"},id:"annotation_catalog",type:"annotation_track",id_field:"{{namespace[assoc]}}variant",x_axis:{field:"{{namespace[assoc]}}position"},color:"#0000CC",fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}chromosome","{{namespace[assoc]}}position","{{namespace[catalog]}}variant","{{namespace[catalog]}}rsid","{{namespace[catalog]}}trait","{{namespace[catalog]}}log_pvalue","{{namespace[catalog]}}pos"],filters:[{field:"{{namespace[catalog]}}rsid",operator:"!=",value:null},{field:"{{namespace[catalog]}}log_pvalue",operator:">",value:7.301}],behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}]},tooltip:Object(rt.b)(ca),tooltip_positioning:"top"},ba={type:"set_state",position:"right",color:"blue",button_html:"LD Population: ",show_selected:!0,button_title:"Select LD Population: ",state_field:"ld_pop",options:[{display_name:"ALL (default)",value:"ALL"},{display_name:"AFR",value:"AFR"},{display_name:"AMR",value:"AMR"},{display_name:"EAS",value:"EAS"},{display_name:"EUR",value:"EUR"},{display_name:"SAS",value:"SAS"}]},xa={type:"display_options",position:"right",color:"blue",button_html:"Filter...",button_title:"Choose which genes to show",layer_name:"genes",default_config_display_name:"Coding genes & rRNA",options:[{display_name:"All features",display:{filters:null}}]},wa={widgets:[{type:"remove_panel",position:"right",color:"red",group_position:"end"},{type:"move_panel_up",position:"right",group_position:"middle"},{type:"move_panel_down",position:"right",group_position:"start",style:{"margin-left":"0.75em"}}]},ka={widgets:[{type:"title",title:"LocusZoom",subtitle:'<a href="https://statgen.github.io/locuszoom/" target="_blank" rel="noopener">v'.concat("0.13.0-beta.2","</a>"),position:"left"},{type:"download",position:"right",group_position:"end"},{type:"download_png",position:"right",group_position:"start"}]},Sa=function(){var t=Object(rt.b)(ka);return t.widgets.push(Object(rt.b)(ba)),t}(),Oa=function(){var t=Object(rt.b)(ka);return t.widgets.push({type:"shift_region",step:5e5,button_html:">>",position:"right",group_position:"end"},{type:"shift_region",step:5e4,button_html:">",position:"right",group_position:"middle"},{type:"zoom_region",step:.2,position:"right",group_position:"middle"},{type:"zoom_region",step:-.2,position:"right",group_position:"middle"},{type:"shift_region",step:-5e4,button_html:"<",position:"right",group_position:"middle"},{type:"shift_region",step:-5e5,button_html:"<<",position:"right",group_position:"start"}),t}(),za={id:"association",width:800,height:225,min_width:400,min_height:200,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgb(210, 210, 210)",toolbar:function(){var t=Object(rt.b)(wa);return t.widgets.push({type:"toggle_legend",position:"right"}),t}(),axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"},y1:{label:"-log10 p-value",label_offset:28},y2:{label:"Recombination Rate (cM/Mb)",label_offset:40}},legend:{orientation:"vertical",origin:{x:55,y:40},hidden:!0},interaction:{drag_background_to_pan:!0,drag_x_ticks_to_scale:!0,drag_y1_ticks_to_scale:!0,drag_y2_ticks_to_scale:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[Object(rt.b)(ha),Object(rt.b)(da),Object(rt.b)(pa)]},Ea={id:"coaccessibility",width:800,height:225,min_width:400,min_height:100,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgb(210, 210, 210)",toolbar:Object(rt.b)(wa),axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"},y1:{label:"Score",label_offset:28,render:!1}},interaction:{drag_background_to_pan:!0,drag_x_ticks_to_scale:!0,drag_y1_ticks_to_scale:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[Object(rt.b)(fa)]},ja=function(){var t=Object(rt.b)(za);return(t=Object(rt.c)({id:"associationcatalog",namespace:{assoc:"assoc",ld:"ld",catalog:"catalog"}},t)).toolbar.widgets.push({type:"display_options",position:"right",color:"blue",button_html:"Display options...",button_title:"Control how plot items are displayed",layer_name:"associationpvaluescatalog",default_config_display_name:"No catalog labels (default)",options:[{display_name:"Label catalog traits",display:{label:{text:"{{{{namespace[catalog]}}trait}}",spacing:6,lines:{style:{"stroke-width":"2px",stroke:"#333333","stroke-dasharray":"2px 2px"}},filters:[{field:"{{namespace[catalog]}}trait",operator:"!=",value:null},{field:"{{namespace[catalog]}}log_pvalue",operator:">",value:7.301},{field:"{{namespace[ld]}}state",operator:">",value:.4}],style:{"font-size":"10px","font-weight":"bold",fill:"#333333"}}}}]}),t.data_layers=[Object(rt.b)(ha),Object(rt.b)(da),Object(rt.b)(ya)],t}(),Ma={id:"genes",width:800,height:225,min_width:400,min_height:112.5,proportional_width:1,margin:{top:20,right:50,bottom:20,left:50},axes:{},interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},toolbar:function(){var t=Object(rt.b)(wa);return t.widgets.push({type:"resize_to_data",position:"right",button_html:"Resize"},Object(rt.b)(xa)),t}(),data_layers:[Object(rt.b)(ma)]},Pa={id:"phewas",width:800,height:300,min_width:800,min_height:300,proportional_width:1,margin:{top:20,right:50,bottom:120,left:50},inner_border:"rgb(210, 210, 210)",axes:{x:{ticks:{style:{"font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"rotate(50)",position:"left"}},y1:{label:"-log10 p-value",label_offset:28}},data_layers:[Object(rt.b)(ha),Object(rt.b)(_a)]},Aa={id:"annotationcatalog",width:800,height:45,min_height:45,proportional_width:1,margin:{top:25,right:50,bottom:0,left:50},inner_border:"rgb(210, 210, 210)",toolbar:Object(rt.b)(wa),interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[Object(rt.b)(va)]},Ra={state:{},width:800,height:450,responsive_resize:!0,min_region_scale:2e4,max_region_scale:1e6,toolbar:Object(rt.b)(Sa),panels:[Object(rt.c)({proportional_height:.5},Object(rt.b)(za)),Object(rt.c)({proportional_height:.5},Object(rt.b)(Ma))]},Na={state:{},width:800,height:500,responsive_resize:!0,min_region_scale:2e4,max_region_scale:1e6,toolbar:Object(rt.b)(Sa),panels:[Object(rt.b)(Aa),Object(rt.b)(ja),Object(rt.b)(Ma)]},Ta={width:800,height:600,min_width:800,min_height:600,responsive_resize:!0,toolbar:Object(rt.b)(ka),panels:[Object(rt.c)({proportional_height:.5},Object(rt.b)(Pa)),Object(rt.c)({proportional_height:.5,margin:{bottom:40},axes:{x:{label:"Chromosome {{chr}} (Mb)",label_offset:32,tick_format:"region",extent:"state"}}},Object(rt.b)(Ma))],mouse_guide:!1},Ia={state:{},width:800,height:450,responsive_resize:!0,min_region_scale:2e4,max_region_scale:1e6,toolbar:Object(rt.b)(ka),panels:[Object.assign({proportional_height:.4},Object(rt.b)(Ea)),function(){var t=Object.assign({proportional_height:.6},Object(rt.b)(Ma)),e=t.data_layers[0];e.match={send:"gene_name",receive:"gene_name"};var n=[{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!0,then:"#ff0000"}},{field:"lz_highlight_match",scale_function:"if",parameters:{field_value:!1,then:"#EAE6E6"}},"#363696"];return e.color=n,e.stroke=n,t}()]},Da={standard_association:oa,standard_association_with_label:sa,standard_genes:la,catalog_variant:ca,coaccessibility:ua},Ca={ldlz2_pop_selector:ba,gene_selector_menu:xa},La={standard_panel:wa,standard_plot:ka,standard_association:Sa,region_nav_plot:Oa},Ba={significance:ha,recomb_rate:da,association_pvalues:pa,coaccessibility:fa,association_pvalues_catalog:ya,phewas_pvalues:_a,genes:ga,genes_filtered:ma,annotation_catalog:va},Ua={association:za,coaccessibility:Ea,association_catalog:ja,genes:Ma,phewas:Pa,annotation_catalog:Aa},Fa={standard_association:Ra,association_catalog:Na,standard_phewas:Ta,coaccessibility:Ia};function qa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||Ga(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ga(t,e){if(t){if("string"==typeof t)return Ha(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ha(t,e):void 0}}function Ha(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function Za(t){return(Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ka(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function Ja(t,e,n){return(Ja="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xa(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Va(t,e){return(Va=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ya(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Xa(t);if(e){var r=Xa(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Wa(this,n)}}function Wa(t,e){return!e||"object"!==Za(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xa(t){return(Xa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}for(var Qa=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Va(t,e)}(i,t);var e,n,a,r=Ya(i);function i(){return Ka(this,i),r.apply(this,arguments)}return e=i,(n=[{key:"get",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||!e)throw new Error("Must specify both the type and name for the layout desired. See .list() for available options");var a=Ja(Xa(i.prototype),"get",this).call(this,t).get(e);if((a=Object(rt.c)(n,a)).unnamespaced)return delete a.unnamespaced,Object(rt.b)(a);var r="";"string"==typeof a.namespace?r=a.namespace:"object"==Za(a.namespace)&&Object.keys(a.namespace).length&&(r=void 0!==a.namespace.default?a.namespace.default:a.namespace[Object.keys(a.namespace)[0]].toString()),r+=r.length?":":"";var o=Object(rt.a)(a,a.namespace,r);return Object(rt.b)(o)}},{key:"add",value:function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(t&&e&&n))throw new Error("To add a layout, type, name, and item must all be specified");if("object"!==Za(n))throw new Error("The configuration to be added must be an object");this.has(t)||Ja(Xa(i.prototype),"add",this).call(this,t,new v);var r=Object(rt.b)(n);return Ja(Xa(i.prototype),"get",this).call(this,t).add(e,r,a)}},{key:"list",value:function(t){if(!t){var e,n={},a=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Ga(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}(this._items);try{for(a.s();!(e=a.n()).done;){var r=qa(e.value,2),o=r[0],s=r[1];n[o]=s.list()}}catch(t){a.e(t)}finally{a.f()}return n}return Ja(Xa(i.prototype),"get",this).call(this,t).list()}},{key:"merge",value:function(t,e){return Object(rt.c)(t,e)}}])&&$a(e.prototype,n),a&&$a(e,a),i}(v)),tr=0,er=Object.entries(s);tr<er.length;tr++)for(var nr=qa(er[tr],2),ar=nr[0],rr=nr[1],ir=0,or=Object.entries(rr);ir<or.length;ir++){var sr=qa(or[ir],2),lr=sr[0],cr=sr[1];Qa.add(ar,lr,cr)}var ur=Qa;function hr(t){return(hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return pr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function fr(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function yr(t,e,n){return(yr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vr(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function _r(t,e){return(_r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=vr(t);if(e){var r=vr(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return mr(this,n)}}function mr(t,e){return!e||"object"!==hr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function vr(t){return(vr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var br={version:"0.13.0-beta.2",populate:function(t,e,n){if(void 0===t)throw new Error("LocusZoom.populate selector not defined");var a;return A.select(t).html(""),A.select(t).call((function(t){if(void 0===t.node().id){for(var r=0;!A.select("#lz-".concat(r)).empty();)r++;t.attr("id","#lz-".concat(r))}if((a=new ye(t.node().id,e,n)).container=t.node(),void 0!==t.node().dataset&&void 0!==t.node().dataset.region){var i=function(t){var e=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/.exec(t);if(e){if("+"===e[3]){var n=me(e[2]),a=me(e[4]);return{chr:e[1],start:n-a,end:n+a}}return{chr:e[1],start:me(e[2]),end:me(e[4])}}if(e=/^(\w+):([\d,.]+[kmgbKMGB]*)$/.exec(t))return{chr:e[1],position:me(e[2])};return null}(t.node().dataset.region);Object.keys(i).forEach((function(t){a.state[t]=i[t]}))}a.svg=A.select("div#".concat(a.id)).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id","".concat(a.id,"_svg")).attr("class","lz-locuszoom").call(dt,a.layout.style),a.setDimensions(),a.positionPanels(),a.initialize(),e&&a.refresh()})),a},DataSources:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_r(t,e)}(i,t);var e,n,a,r=gr(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this))._registry=t||P,e}return e=i,(n=[{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._registry.has(t))throw new Error("The namespace ".concat(t," is already in use by another source"));if(t.match(/[^A-Za-z0-9_]/))throw new Error("Data source namespace names can only contain alphanumeric characters or underscores. Invalid name: ".concat(t));if(Array.isArray(e)){var a=e,r=dr(a,2),o=r[0],s=r[1];e=this._registry.create(o,s)}return e.source_id=t,yr(vr(i.prototype),"add",this).call(this,t,e,n),this}}])&&fr(e.prototype,n),a&&fr(e,a),i}(v),Adapters:P,DataLayers:ia,Layouts:ur,ScaleFunctions:Ne,TransformationFunctions:et,Widgets:Xt,get KnownDataSources(){return console.warn('Deprecation warning: KnownDataSources has been renamed to "Adapters"'),P}},xr=[];br.use=function(t){if(!xr.includes(t)){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];if(n.unshift(br),"function"==typeof t.install)t.install.apply(t,n);else{if("function"!=typeof t)throw new Error("Plugin must export a function that receives the LocusZoom object as an argument");t.apply(null,n)}xr.push(t)}};e.default=br},2:function(t,e,n){"use strict";function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){r=!0,i=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=h(t);if(e){var r=h(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u(this,n)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function f(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t}function y(t,e,n){if(e&&n||!e&&!n)throw new Error("".concat(t,' must provide a parameter specifying either "build" or "source". It should not specify both.'));if(e&&!["GRCh37","GRCh38"].includes(e))throw new Error("".concat(t," must specify a valid genome build number"))}n.r(e),n.d(e,"BaseAdapter",(function(){return _})),n.d(e,"BaseApiAdapter",(function(){return g})),n.d(e,"AssociationLZ",(function(){return m})),n.d(e,"ConnectorSource",(function(){return z})),n.d(e,"GeneConstraintLZ",(function(){return w})),n.d(e,"GeneLZ",(function(){return x})),n.d(e,"GwasCatalogLZ",(function(){return b})),n.d(e,"LDServer",(function(){return v})),n.d(e,"PheWASLZ",(function(){return O})),n.d(e,"RecombLZ",(function(){return k})),n.d(e,"StaticSource",(function(){return S}));var _=function(){function t(e){d(this,t),this._enableCache=!0,this._cachedKey=null,this.__dependentSource=!1,this.parseInit(e)}return f(t,[{key:"parseInit",value:function(t){this.params=t.params||{}}},{key:"getCacheKey",value:function(t,e,n){return this.getURL(t,e,n)}},{key:"getURL",value:function(t,e,n){return this.url}},{key:"fetchRequest",value:function(t,e,n){var a=this.getURL(t,e,n);return fetch(a).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.text()}))}},{key:"getRequest",value:function(t,e,n){var a,r=this.getCacheKey(t,e,n);return this._enableCache&&void 0!==r&&r===this._cachedKey?a=Promise.resolve(this._cachedResponse):(a=this.fetchRequest(t,e,n),this._enableCache&&(this._cachedKey=r,this._cachedResponse=a)),a}},{key:"normalizeResponse",value:function(t){if(Array.isArray(t))return t;var e=Object.keys(t),n=t[e[0]].length;if(!e.every((function(e){return t[e].length===n})))throw new Error("".concat(this.constructor.name," expects a response in which all arrays of data are the same length"));for(var a=[],r=Object.keys(t),i=0;i<n;i++){for(var o={},s=0;s<r.length;s++)o[r[s]]=t[r[s]][i];a.push(o)}return a}},{key:"annotateData",value:function(t,e){return t}},{key:"extractFields",value:function(t,e,n,a){if(!Array.isArray(t))return t;if(!t.length)return t;for(var r=[],i=0;i<e.length;i++)r[i]=0;var o=t.map((function(t){for(var i={},o=0;o<e.length;o++){var s=t[e[o]];void 0!==s&&(r[o]=1),a&&a[o]&&(s=a[o](s)),i[n[o]]=s}return i}));return r.forEach((function(t,a){if(!t)throw new Error("field ".concat(e[a]," not found in response for ").concat(n[a]))})),o}},{key:"combineChainBody",value:function(t,e,n,a,r){return t}},{key:"parseResponse",value:function(t,e,n,a,r){var i=this,o=this.source_id||this.constructor.name;e.discrete||(e.discrete={});var s="string"==typeof t?JSON.parse(t):t;return Promise.resolve(this.normalizeResponse(s.data||s)).then((function(t){return Promise.resolve(i.annotateData(t,e))})).then((function(t){return Promise.resolve(i.extractFields(t,n,a,r))})).then((function(t){return e.discrete[o]=t,Promise.resolve(i.combineChainBody(t,e,n,a,r))})).then((function(t){return{header:e.header||{},discrete:e.discrete,body:t}}))}},{key:"getData",value:function(t,e,n,a){var r=this;if(this.preGetData){var i=this.preGetData(t,e,n,a);this.pre&&(t=i.state||t,e=i.fields||e,n=i.outnames||n,a=i.trans||a)}return function(i){return r.__dependentSource&&i&&i.body&&!i.body.length?Promise.resolve(i):r.getRequest(t,i,e).then((function(t){return r.parseResponse(t,i,e,n,a)}))}}}]),t}(),g=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"parseInit",value:function(t){if(o(h(n.prototype),"parseInit",this).call(this,t),this.url=t.url,!this.url)throw new Error("Source not initialized with required URL")}}]),n}(_),m=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"preGetData",value:function(t,e,n,a){return[this.params.id_field||"id","position"].forEach((function(t){e.includes(t)||(e.unshift(t),n.unshift(t),a.unshift(null))})),{fields:e,outnames:n,trans:a}}},{key:"getURL",value:function(t,e,n){var a=e.header.analysis||this.params.source||this.params.analysis;if(void 0===a)throw new Error("Association source must specify an analysis ID to plot");return"".concat(this.url,"results/?filter=analysis in ").concat(a," and chromosome in  '").concat(t.chr,"' and position ge ").concat(t.start," and position le ").concat(t.end)}},{key:"normalizeResponse",value:function(t){return t=o(h(n.prototype),"normalizeResponse",this).call(this,t),this.params&&this.params.sort&&t.length&&t[0].position&&t.sort((function(t,e){return t.position-e.position})),t}}]),n}(g),v=function(t){s(n,t);var e=c(n);function n(t){var a;return d(this,n),(a=e.call(this,t)).__dependentSource=!0,a}return f(n,[{key:"preGetData",value:function(t,e){if(e.length>1&&(2!==e.length||!e.includes("isrefvar")))throw new Error("LD does not know how to get all fields: ".concat(e.join(", ")))}},{key:"findMergeFields",value:function(t){var e,n={id:this.params.id_field,position:this.params.position_field,pvalue:this.params.pvalue_field,_names_:null};if(t&&t.body&&t.body.length>0){var a=Object.keys(t.body[0]),r=(e=a,function(){for(var t=arguments,n=function(n){var a=t[n],r=e.filter((function(t){return t.match(a)}));if(r.length)return{v:r[0]}},a=0;a<t.length;a++){var r=n(a);if("object"===i(r))return r.v}return null}),o=n.id&&r(new RegExp("".concat(n.id,"\\b")));n.id=o||r(/\bvariant\b/)||r(/\bid\b/),n.position=n.position||r(/\bposition\b/i,/\bpos\b/i),n.pvalue=n.pvalue||r(/\bpvalue\b/i,/\blog_pvalue\b/i),n._names_=a}return n}},{key:"findRequestedFields",value:function(t,e){for(var n={},a=0;a<t.length;a++)"isrefvar"===t[a]?(n.isrefvarin=t[a],n.isrefvarout=e&&e[a]):(n.ldin=t[a],n.ldout=e&&e[a]);return n}},{key:"normalizeResponse",value:function(t){return t}},{key:"getRefvar",value:function(t,e,n){var a=this.findRequestedFields(n).ldin;if("state"===a&&(a=t.ldrefvar||e.header.ldrefvar||"best"),"best"===a){if(!e.body)throw new Error("No association data found to find best pvalue");var r=this.findMergeFields(e);if(!r.pvalue||!r.id){var i="";throw r.id||(i+="".concat(i.length?", ":"","id")),r.pvalue||(i+="".concat(i.length?", ":"","pvalue")),new Error("Unable to find necessary column(s) for merge: ".concat(i," (available: ").concat(r._names_,")"))}a=e.body[function(t,e){var n;n=/log/.test(e=e||"log_pvalue")?function(t,e){return t>e}:function(t,e){return t<e};for(var a=t[0][e],r=0,i=1;i<t.length;i++)n(t[i][e],a)&&(a=t[i][e],r=i);return r}(e.body,r.pvalue)][r.id]}return a}},{key:"getURL",value:function(t,e,n){var r=t.genome_build||this.params.build||"GRCh37",i=t.ld_source||this.params.source||"1000G",o=t.ld_pop||this.params.population||"ALL",s=this.params.method||"rsquare";"1000G"===i&&"GRCh38"===r&&(i="1000G-FRZ09"),y(this.constructor.name,r,null);var l=this.getRefvar(t,e,n),c=l&&l.match(/^(?:chr)?([a-zA-Z0-9]+?)[_:-](\d+)[_:|-]?(\w+)?[/_:|-]?([^_]+)?_?(.*)?/);if(!c)throw new Error("Could not request LD for a missing or incomplete marker format");var u=a(c,5),h=u[0],d=u[1],p=u[2],f=u[3],_=u[4];return l="".concat(d,":").concat(p),f&&_&&(l+="_".concat(f,"/").concat(_)),e.header.ldrefvar=h,[this.url,"genome_builds/",r,"/references/",i,"/populations/",o,"/variants","?correlation=",s,"&variant=",encodeURIComponent(l),"&chrom=",encodeURIComponent(t.chr),"&start=",encodeURIComponent(t.start),"&stop=",encodeURIComponent(t.end)].join("")}},{key:"combineChainBody",value:function(t,e,n,a,r){var i=this.findMergeFields(e),o=this.findRequestedFields(n,a);if(!i.position)throw new Error("Unable to find position field for merge: ".concat(i._names_));var s=t.rsquare?"rsquare":"correlation";return function(t,e,n,a){for(var r=0,o=0;r<t.length&&o<e.position2.length;)t[r][i.position]===e.position2[o]?(t[r][n]=e[a][o],r++,o++):t[r][i.position]<e.position2[o]?r++:o++}(e.body,t,o.ldout,s),o.isrefvarin&&e.header.ldrefvar&&function(t,e,n,a,r){for(var i=0;i<t.length;i++)t[i][n]&&t[i][n]===e?(t[i][a]=1,t[i][r]=1):t[i][a]=0}(e.body,e.header.ldrefvar,i.id,o.isrefvarout,o.ldout),e.body}},{key:"fetchRequest",value:function(t,e,n){var a=this.getURL(t,e,n),r={data:{}};return function t(e){return fetch(e).then().then((function(t){if(!t.ok)throw new Error(t.statusText);return t.text()})).then((function(e){return e=JSON.parse(e),Object.keys(e.data).forEach((function(t){r.data[t]=(r.data[t]||[]).concat(e.data[t])})),e.next?t(e.next):r}))}(a)}}]),n}(g),b=function(t){s(n,t);var e=c(n);function n(t){var a;return d(this,n),(a=e.call(this,t)).__dependentSource=!0,a}return f(n,[{key:"getURL",value:function(t,e,n){var a=t.genome_build||this.params.build;y(this.constructor.name,a,null);var r="GRCh38"===a?5:6,i=this.params.source||r;return"".concat(this.url,"?format=objects&sort=pos&filter=id eq ").concat(i," and chrom eq '").concat(t.chr,"' and pos ge ").concat(t.start," and pos le ").concat(t.end)}},{key:"findMergeFields",value:function(t){var e=Object.keys(t).find((function(t){return t.match(/\b(position|pos)\b/i)}));if(!e)throw new Error("Could not find data to align with GWAS catalog results");return{pos:e}}},{key:"extractFields",value:function(t,e,n,a){return t}},{key:"combineChainBody",value:function(t,e,n,a,r){if(!t.length)return e.body;var i=a[n.indexOf("log_pvalue")];function o(t,e,n,a,r){var o=t.n_catalog_matches||0;if(t.n_catalog_matches=o+1,!(t[i]&&t[i]>e.log_pvalue))for(var s=0;s<n.length;s++){var l=n[s],c=a[s],u=e[l];r&&r[s]&&(u=r[s](u)),t[c]=u}}for(var s=this.findMergeFields(e.body[0]),l=this.findMergeFields(t[0]),c=0,u=0;c<e.body.length&&u<t.length;){var h=e.body[c],d=t[u];h[s.pos]===d[l.pos]?(o(h,d,n,a,r),u+=1):h[s.pos]<d[l.pos]?c+=1:u+=1}return e.body}}]),n}(g),x=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"getURL",value:function(t,e,n){var a=t.genome_build||this.params.build,r=this.params.source;return y(this.constructor.name,a,r),a&&(r="GRCh38"===a?4:5),"".concat(this.url,"?filter=source in ").concat(r," and chrom eq '").concat(t.chr,"' and start le ").concat(t.end," and end ge ").concat(t.start)}},{key:"normalizeResponse",value:function(t){return t}},{key:"extractFields",value:function(t,e,n,a){return t}}]),n}(g),w=function(t){s(n,t);var e=c(n);function n(t){var a;return d(this,n),(a=e.call(this,t)).__dependentSource=!0,a}return f(n,[{key:"getURL",value:function(){return this.url}},{key:"getCacheKey",value:function(t,e,n){var a=t.genome_build||this.params.build;return"".concat(this.url," ").concat(t.chr," ").concat(t.start," ").concat(t.end," ").concat(a)}},{key:"normalizeResponse",value:function(t){return t}},{key:"fetchRequest",value:function(t,e,n){var a=t.genome_build||this.params.build;if(!a)throw new Error("Data source ".concat(this.constructor.name," must specify a 'genome_build' option"));var r=e.body.reduce((function(t,e){return t[e.gene_name]=null,t}),{}),i=Object.keys(r).map((function(t){var e="_".concat(t.replace(/[^A-Za-z0-9_]/g,"_"));return"".concat(e,': gene(gene_symbol: "').concat(t,'", reference_genome: ').concat(a,") { gnomad_constraint { exp_syn obs_syn syn_z oe_syn oe_syn_lower oe_syn_upper exp_mis obs_mis mis_z oe_mis oe_mis_lower oe_mis_upper exp_lof obs_lof pLI oe_lof oe_lof_lower oe_lof_upper } } ")}));if(!i.length)return Promise.resolve({data:null});i="{".concat(i.join(" ")," }");var o=this.getURL(t,e,n),s=JSON.stringify({query:i});return fetch(o,{method:"POST",body:s,headers:{"Content-Type":"application/json"}}).then((function(t){return t.ok?t.text():[]})).catch((function(t){return[]}))}},{key:"combineChainBody",value:function(t,e,n,a,r){return t?(e.body.forEach((function(e){var n="_".concat(e.gene_name.replace(/[^A-Za-z0-9_]/g,"_")),a=t[n]&&t[n].gnomad_constraint;a&&Object.keys(a).forEach((function(t){var n=a[t];void 0===e[t]&&("number"==typeof n&&n.toString().includes(".")&&(n=parseFloat(n.toFixed(2))),e[t]=n)}))})),e.body):e}}]),n}(g),k=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"getURL",value:function(t,e,n){var a=t.genome_build||this.params.build,r=this.params.source;return y(this.constructor.SOURCE_NAME,a,r),a&&(r="GRCh38"===a?16:15),"".concat(this.url,"?filter=id in ").concat(r," and chromosome eq '").concat(t.chr,"' and position le ").concat(t.end," and position ge ").concat(t.start)}}]),n}(g),S=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"parseInit",value:function(t){this._data=t}},{key:"getRequest",value:function(t,e,n){return Promise.resolve(this._data)}}]),n}(_),O=function(t){s(n,t);var e=c(n);function n(){return d(this,n),e.apply(this,arguments)}return f(n,[{key:"getURL",value:function(t,e,n){var a=(t.genome_build?[t.genome_build]:null)||this.params.build;if(!a||!Array.isArray(a)||!a.length)throw new Error(["Data source",this.constructor.SOURCE_NAME,"requires that you specify array of one or more desired genome build names"].join(" "));return[this.url,"?filter=variant eq '",encodeURIComponent(t.variant),"'&format=objects&",a.map((function(t){return"build=".concat(encodeURIComponent(t))})).join("&")].join("")}}]),n}(g),z=function(t){s(n,t);var e=c(n);function n(t){var a;if(d(this,n),a=e.call(this,t),!t||!t.sources)throw new Error("Connectors must specify the data they require as init.sources = {internal_name: chain_source_id}} pairs");a._source_name_mapping=t.sources;var r=Object.keys(t.sources);return a._getRequiredSources().forEach((function(t){if(!r.includes(t))throw new Error("Configuration for ".concat(a.constructor.name," must specify a source ID corresponding to ").concat(t))})),a}return f(n,[{key:"parseInit",value:function(){}},{key:"getRequest",value:function(t,e,n){var a=this;return Object.keys(this._source_name_mapping).forEach((function(t){var n=a._source_name_mapping[t];if(e.discrete&&!e.discrete[n])throw new Error("".concat(a.constructor.name," cannot be used before loading required data for: ").concat(n))})),Promise.resolve(e.body||[])}},{key:"parseResponse",value:function(t,e,n,a,r){return Promise.resolve(this.combineChainBody(t,e,n,a,r)).then((function(t){return{header:e.header||{},discrete:e.discrete||{},body:t}}))}},{key:"combineChainBody",value:function(t,e){throw new Error("This method must be implemented in a subclass")}},{key:"_getRequiredSources",value:function(){throw new Error("Must specify an array that identifes the kind of data required by this source")}}]),n}(_)}}).default;
//# sourceMappingURL=locuszoom.app.min.js.map